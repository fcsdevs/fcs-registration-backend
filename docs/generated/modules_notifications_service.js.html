<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/notifications/service.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/notifications/service.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { getPrismaClient } from '../../lib/prisma.js';
import { NotFoundError, AppError } from '../../middleware/error-handler.js';
import { getEffectiveScope } from '../users/service.js';

const prisma = getPrismaClient();

/**
 * Create notification trigger
 */
export const createNotificationTrigger = async (data) => {
  const {
    eventId,
    triggerType, // REGISTRATION | GROUP_ASSIGNMENT | CENTER_ASSIGNMENT | EVENT_REMINDER
    deliveryMethod, // EMAIL | SMS | PUSH
    templateId,
    recipientType, // MEMBER | PARENT | ADMIN
    isActive = true,
  } = data;

  // Verify event exists
  const event = await prisma.event.findUnique({
    where: { id: eventId },
  });

  if (!event) {
    throw new NotFoundError('Event not found');
  }

  const trigger = await prisma.notificationTrigger.create({
    data: {
      eventId,
      triggerType,
      deliveryMethod,
      templateId,
      recipientType,
      isActive,
      createdAt: new Date(),
    },
  });

  return trigger;
};

/**
 * Get notification trigger
 */
export const getNotificationTrigger = async (triggerId) => {
  const trigger = await prisma.notificationTrigger.findUnique({
    where: { id: triggerId },
  });

  if (!trigger) {
    throw new NotFoundError('Notification trigger not found');
  }

  return trigger;
};

/**
 * List notification triggers by event
 */
export const listNotificationTriggers = async (eventId, query = {}) => {
  const { triggerType, deliveryMethod } = query;

  const where = {
    eventId,
    ...(triggerType &amp;&amp; { triggerType }),
    ...(deliveryMethod &amp;&amp; { deliveryMethod }),
    isActive: true,
  };

  const triggers = await prisma.notificationTrigger.findMany({
    where,
    orderBy: { createdAt: 'desc' },
  });

  return triggers;
};

/**
 * Send notification (email/SMS)
 */
export const sendNotification = async (data) => {
  const {
    recipientId,
    recipientEmail,
    recipientPhone,
    deliveryMethod, // EMAIL | SMS | PUSH
    subject,
    message,
    templateData = {},
    triggerType,
  } = data;

  // Create notification record
  const notification = await prisma.notification.create({
    data: {
      eventId: data.eventId,
      recipientId,
      recipientEmail,
      recipientPhone,
      deliveryMethod,
      subject,
      message,
      templateData,
      triggerType: triggerType || 'GENERAL',
      status: 'PENDING',
      createdAt: new Date(),
    },
  });

  // Queue for actual sending (integration with email/SMS providers)
  await queueNotificationJob(notification.id, {
    recipientEmail,
    recipientPhone,
    deliveryMethod,
    subject,
    message,
  });

  return notification;
};

import { sendMail } from '../../lib/mail.js';

/**
 * Queue notification job (background worker)
 */
const queueNotificationJob = async (id, data) => {
  // Execute asynchronously 
  setTimeout(async () => {
    try {
      console.log(`[Worker] Processing notification ${id} (${data.deliveryMethod})`);

      let sentResult = null;
      if (data.deliveryMethod === 'EMAIL') {
        sentResult = await sendMail({
          to: data.recipientEmail,
          subject: data.subject,
          text: data.message,
          html: data.message.replace(/\n/g, '&lt;br/>'),
        });
      }

      // Update status to SENT
      await prisma.notification.update({
        where: { id },
        data: {
          status: 'SENT',
          sentAt: new Date(),
        }
      });
      console.log(`[Worker] Notification ${id} sent successfully`);
    } catch (error) {
      console.error(`[Worker] Failed to send notification ${id}:`, error);
      await prisma.notification.update({
        where: { id },
        data: {
          status: 'FAILED',
          failureReason: error.message,
        }
      });
    }
  }, 0);
};

/**
 * Send batch notifications
 */
export const sendBatchNotifications = async (data) => {
  const {
    recipients,
    deliveryMethod,
    subject,
    message,
    templateData = {},
    triggerType,
    eventId,
  } = data;

  const notifications = [];

  for (const recipient of recipients) {
    try {
      const notification = await sendNotification({
        recipientId: recipient.id,
        recipientEmail: recipient.email,
        recipientPhone: recipient.phone,
        deliveryMethod,
        subject,
        message,
        templateData,
        triggerType,
        eventId,
      });

      notifications.push({
        recipientId: recipient.id,
        status: 'sent',
        notificationId: notification.id,
      });
    } catch (error) {
      notifications.push({
        recipientId: recipient.id,
        status: 'failed',
        error: error.message,
      });
    }
  }

  return {
    sent: notifications.filter((n) => n.status === 'sent').length,
    failed: notifications.filter((n) => n.status === 'failed').length,
    details: notifications,
  };
};

/**
 * Get notification history
 */
export const getNotificationHistory = async (query = {}) => {
  const { page = 1, limit = 50, recipientId, status, triggerType, userId } = query;
  const skip = (page - 1) * limit;

  const where = {
    ...(status &amp;&amp; { status }),
    ...(triggerType &amp;&amp; { triggerType }),
  };

  // Enforce recipient check for non-admins
  if (userId) {
    const scope = await getEffectiveScope(userId);
    if (!scope.isGlobal &amp;&amp; !scope.unitId) {
      // Basic User: fetch their member record
      const member = await prisma.member.findFirst({
        where: { authUserId: userId },
        select: { id: true },
      });
      if (member) {
        where.recipientId = member.id;
      } else {
        // If no member record, they see nothing
        return { data: [], pagination: { page, limit, total: 0, pages: 0 } };
      }
    } else {
      // Admin: can filter by recipientId if provided
      if (recipientId) {
        where.recipientId = recipientId;
      }
    }
  } else if (recipientId) {
    where.recipientId = recipientId;
  }

  const [notifications, total] = await Promise.all([
    prisma.notification.findMany({
      where,
      orderBy: { createdAt: 'desc' },
      skip,
      take: limit,
      include: {
        member: {
          select: {
            firstName: true,
            lastName: true,
            fcsCode: true,
          },
        },
        event: {
          select: {
            title: true,
          },
        },
      },
    }),
    prisma.notification.count({ where }),
  ]);

  return {
    data: notifications,
    pagination: {
      page,
      limit,
      total,
      pages: Math.ceil(total / limit),
    },
  };
};

/**
 * Trigger registration notifications
 */
export const triggerRegistrationNotifications = async (registrationId) => {
  const registration = await prisma.registration.findUnique({
    where: { id: registrationId },
    include: {
      member: true,
      event: true,
    },
  });

  if (!registration) {
    throw new NotFoundError('Registration not found');
  }

  // Get notification triggers for this event
  const triggers = await listNotificationTriggers(registration.event.id, {
    triggerType: 'REGISTRATION',
  });

  const results = [];

  for (const trigger of triggers) {
    try {
      const notification = await sendNotification({
        recipientId: registration.member.id,
        recipientEmail: registration.member.email,
        recipientPhone: registration.member.phoneNumber || registration.member.whatsappNumber,
        deliveryMethod: trigger.deliveryMethod,
        subject: `Registration Confirmed - ${registration.event.title}`,
        message: `Your registration for ${registration.event.title} has been confirmed.`,
        triggerType: 'REGISTRATION',
        eventId: registration.event.id,
      });

      results.push({
        triggerId: trigger.id,
        notificationId: notification.id,
        status: 'sent',
      });
    } catch (error) {
      results.push({
        triggerId: trigger.id,
        status: 'failed',
        error: error.message,
      });
    }
  }

  return results;
};

/**
 * Trigger center assignment notifications
 */
export const triggerCenterAssignmentNotifications = async (registrationId) => {
  const registration = await prisma.registration.findUnique({
    where: { id: registrationId },
    include: {
      member: true,
      event: true,
      center: true,
    },
  });

  if (!registration) {
    throw new NotFoundError('Registration not found');
  }

  if (!registration.center) {
    return { message: 'No center assigned' };
  }

  const triggers = await listNotificationTriggers(registration.event.id, {
    triggerType: 'CENTER_ASSIGNMENT',
  });

  const results = [];

  for (const trigger of triggers) {
    try {
      const notification = await sendNotification({
        recipientId: registration.member.id,
        recipientEmail: registration.member.email,
        recipientPhone: registration.member.phoneNumber || registration.member.whatsappNumber,
        deliveryMethod: trigger.deliveryMethod,
        subject: `Center Assignment - ${registration.event.title}`,
        message: `You have been assigned to ${registration.center.centerName} for ${registration.event.title}.`,
        triggerType: 'CENTER_ASSIGNMENT',
        eventId: registration.event.id,
      });

      results.push({
        triggerId: trigger.id,
        notificationId: notification.id,
        status: 'sent',
      });
    } catch (error) {
      results.push({
        triggerId: trigger.id,
        status: 'failed',
        error: error.message,
      });
    }
  }

  return results;
};

/**
 * Trigger group assignment notifications
 */
export const triggerGroupAssignmentNotifications = async (registrationId) => {
  const registration = await prisma.registration.findUnique({
    where: { id: registrationId },
    include: {
      member: true,
      event: true,
      group: true,
    },
  });

  if (!registration) {
    throw new NotFoundError('Registration not found');
  }

  if (!registration.group) {
    return { message: 'No group assigned' };
  }

  const triggers = await listNotificationTriggers(registration.event.id, {
    triggerType: 'GROUP_ASSIGNMENT',
  });

  const results = [];

  for (const trigger of triggers) {
    try {
      const notification = await sendNotification({
        recipientId: registration.member.id,
        recipientEmail: registration.member.email,
        recipientPhone: registration.member.phoneNumber || registration.member.whatsappNumber,
        deliveryMethod: trigger.deliveryMethod,
        subject: `Group Assignment - ${registration.event.title}`,
        message: `You have been assigned to ${registration.group.name} for ${registration.event.title}.`,
        triggerType: 'GROUP_ASSIGNMENT',
        eventId: registration.event.id,
      });

      results.push({
        triggerId: trigger.id,
        notificationId: notification.id,
        status: 'sent',
      });
    } catch (error) {
      results.push({
        triggerId: trigger.id,
        status: 'failed',
        error: error.message,
      });
    }
  }

  return results;
};

/**
 * Trigger event reminder notifications
 */
export const triggerEventReminderNotifications = async (eventId) => {
  const event = await prisma.event.findUnique({
    where: { id: eventId },
  });

  if (!event) {
    throw new NotFoundError('Event not found');
  }

  // Get all registrations for event
  const registrations = await prisma.registration.findMany({
    where: { eventId },
    include: { member: true },
  });

  const triggers = await listNotificationTriggers(eventId, {
    triggerType: 'EVENT_REMINDER',
  });

  const results = [];

  for (const registration of registrations) {
    for (const trigger of triggers) {
      try {
        const notification = await sendNotification({
          recipientId: registration.member.id,
          recipientEmail: registration.member.email,
          recipientPhone: registration.member.phoneNumber || registration.member.whatsappNumber,
          deliveryMethod: trigger.deliveryMethod,
          subject: `Reminder: ${event.title}`,
          message: `This is a reminder that ${event.title} is coming up on ${event.startDate}.`,
          triggerType: 'EVENT_REMINDER',
          eventId: event.id,
        });

        results.push({
          registrationId: registration.id,
          notificationId: notification.id,
          status: 'sent',
        });
      } catch (error) {
        results.push({
          registrationId: registration.id,
          status: 'failed',
          error: error.message,
        });
      }
    }
  }

  return {
    eventId,
    totalSent: results.filter((r) => r.status === 'sent').length,
    totalFailed: results.filter((r) => r.status === 'failed').length,
  };
};

/**
 * Mark notification as read/delivered
 */
export const markNotificationAsDelivered = async (notificationId) => {
  const notification = await prisma.notification.update({
    where: { id: notificationId },
    data: {
      status: 'DELIVERED',
      deliveredAt: new Date(),
    },
  });

  return notification;
};

/**
 * Update notification trigger status
 */
export const updateNotificationTrigger = async (triggerId, data) => {
  const trigger = await prisma.notificationTrigger.findUnique({
    where: { id: triggerId },
  });

  if (!trigger) {
    throw new NotFoundError('Notification trigger not found');
  }

  const { isActive } = data;

  const updated = await prisma.notificationTrigger.update({
    where: { id: triggerId },
    data: {
      ...(isActive !== undefined &amp;&amp; { isActive }),
    },
  });

  return updated;
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addCenterAdmin">addCenterAdmin</a></li><li><a href="global.html#addCenterAdminHandler">addCenterAdminHandler</a></li><li><a href="global.html#addGuardian">addGuardian</a></li><li><a href="global.html#addGuardianHandler">addGuardianHandler</a></li><li><a href="global.html#addMemberHandler">addMemberHandler</a></li><li><a href="global.html#addMemberToUnit">addMemberToUnit</a></li><li><a href="global.html#assignCenter">assignCenter</a></li><li><a href="global.html#assignCenterHandler">assignCenterHandler</a></li><li><a href="global.html#assignGroup">assignGroup</a></li><li><a href="global.html#assignGroupHandler">assignGroupHandler</a></li><li><a href="global.html#assignMemberHandler">assignMemberHandler</a></li><li><a href="global.html#assignMemberToGroup">assignMemberToGroup</a></li><li><a href="global.html#assignRoleHandler">assignRoleHandler</a></li><li><a href="global.html#assignRoleToUser">assignRoleToUser</a></li><li><a href="global.html#bulkAssignGroups">bulkAssignGroups</a></li><li><a href="global.html#bulkAssignHandler">bulkAssignHandler</a></li><li><a href="global.html#bulkSyncAttendance">bulkSyncAttendance</a></li><li><a href="global.html#bulkSyncHandler">bulkSyncHandler</a></li><li><a href="global.html#calculateAttendanceRate">calculateAttendanceRate</a></li><li><a href="global.html#cancelRegistration">cancelRegistration</a></li><li><a href="global.html#cancelRegistrationHandler">cancelRegistrationHandler</a></li><li><a href="global.html#changePassword">changePassword</a></li><li><a href="global.html#changePasswordHandler">changePasswordHandler</a></li><li><a href="global.html#checkDatabaseTables">checkDatabaseTables</a></li><li><a href="global.html#checkExistence">checkExistence</a></li><li><a href="global.html#checkIn">checkIn</a></li><li><a href="global.html#checkInHandler">checkInHandler</a></li><li><a href="global.html#checkOut">checkOut</a></li><li><a href="global.html#checkOutHandler">checkOutHandler</a></li><li><a href="global.html#checkPermissionHandler">checkPermissionHandler</a></li><li><a href="global.html#checkUserExistence">checkUserExistence</a></li><li><a href="global.html#checkUserPermission">checkUserPermission</a></li><li><a href="global.html#cleanupOldLogsHandler">cleanupOldLogsHandler</a></li><li><a href="global.html#clearIdempotencyCache">clearIdempotencyCache</a></li><li><a href="global.html#clearOldAuditLogs">clearOldAuditLogs</a></li><li><a href="global.html#cloudinaryDelete">cloudinaryDelete</a></li><li><a href="global.html#cloudinaryUpload">cloudinaryUpload</a></li><li><a href="global.html#cloudinaryUploadAudio">cloudinaryUploadAudio</a></li><li><a href="global.html#cloudinaryUploadDocument">cloudinaryUploadDocument</a></li><li><a href="global.html#cloudinaryUploadImage">cloudinaryUploadImage</a></li><li><a href="global.html#cloudinaryUploadVideo">cloudinaryUploadVideo</a></li><li><a href="global.html#comparePassword">comparePassword</a></li><li><a href="global.html#convertAuditLogsToCSV">convertAuditLogsToCSV</a></li><li><a href="global.html#convertReportToCSV">convertReportToCSV</a></li><li><a href="global.html#correctAttendance">correctAttendance</a></li><li><a href="global.html#correctAttendanceHandler">correctAttendanceHandler</a></li><li><a href="global.html#createAuditLog">createAuditLog</a></li><li><a href="global.html#createCenter">createCenter</a></li><li><a href="global.html#createCenterHandler">createCenterHandler</a></li><li><a href="global.html#createEvent">createEvent</a></li><li><a href="global.html#createEventHandler">createEventHandler</a></li><li><a href="global.html#createGroup">createGroup</a></li><li><a href="global.html#createGroupHandler">createGroupHandler</a></li><li><a href="global.html#createMember">createMember</a></li><li><a href="global.html#createMemberHandler">createMemberHandler</a></li><li><a href="global.html#createNotificationTrigger">createNotificationTrigger</a></li><li><a href="global.html#createPredefinedRoles">createPredefinedRoles</a></li><li><a href="global.html#createRateLimiters">createRateLimiters</a></li><li><a href="global.html#createRegistration">createRegistration</a></li><li><a href="global.html#createRegistrationHandler">createRegistrationHandler</a></li><li><a href="global.html#createRole">createRole</a></li><li><a href="global.html#createRoleHandler">createRoleHandler</a></li><li><a href="global.html#createTriggerHandler">createTriggerHandler</a></li><li><a href="global.html#createUnit">createUnit</a></li><li><a href="global.html#createUnitHandler">createUnitHandler</a></li><li><a href="global.html#deactivateCenter">deactivateCenter</a></li><li><a href="global.html#deactivateCenterHandler">deactivateCenterHandler</a></li><li><a href="global.html#deactivateGroup">deactivateGroup</a></li><li><a href="global.html#deactivateGroupHandler">deactivateGroupHandler</a></li><li><a href="global.html#deactivateMember">deactivateMember</a></li><li><a href="global.html#deactivateMemberHandler">deactivateMemberHandler</a></li><li><a href="global.html#deactivateRole">deactivateRole</a></li><li><a href="global.html#deactivateRoleHandler">deactivateRoleHandler</a></li><li><a href="global.html#deactivateUnit">deactivateUnit</a></li><li><a href="global.html#deactivateUnitHandler">deactivateUnitHandler</a></li><li><a href="global.html#deleteEvent">deleteEvent</a></li><li><a href="global.html#deleteEventHandler">deleteEventHandler</a></li><li><a href="global.html#downloadTagHandler">downloadTagHandler</a></li><li><a href="global.html#exportAuditLogs">exportAuditLogs</a></li><li><a href="global.html#exportAuditLogsHandler">exportAuditLogsHandler</a></li><li><a href="global.html#exportEventReport">exportEventReport</a></li><li><a href="global.html#exportEventReportHandler">exportEventReportHandler</a></li><li><a href="global.html#forgotPasswordHandler">forgotPasswordHandler</a></li><li><a href="global.html#formatPaginatedResponse">formatPaginatedResponse</a></li><li><a href="global.html#generateAttendanceCode">generateAttendanceCode</a></li><li><a href="global.html#generateCodeHandler">generateCodeHandler</a></li><li><a href="global.html#generateFCSCode">generateFCSCode</a></li><li><a href="global.html#generateOTP">generateOTP</a></li><li><a href="global.html#generateSignedUrl">generateSignedUrl</a></li><li><a href="global.html#generateTagPdf">generateTagPdf</a></li><li><a href="global.html#generateToken">generateToken</a></li><li><a href="global.html#generateUUID">generateUUID</a></li><li><a href="global.html#getAllAncestorIds">getAllAncestorIds</a></li><li><a href="global.html#getAllDescendantIds">getAllDescendantIds</a></li><li><a href="global.html#getAttendanceSummaryHandler">getAttendanceSummaryHandler</a></li><li><a href="global.html#getAuditLogsByRange">getAuditLogsByRange</a></li><li><a href="global.html#getAuditLogsHandler">getAuditLogsHandler</a></li><li><a href="global.html#getCenterAnalytics">getCenterAnalytics</a></li><li><a href="global.html#getCenterAnalyticsHandler">getCenterAnalyticsHandler</a></li><li><a href="global.html#getCenterAttendance">getCenterAttendance</a></li><li><a href="global.html#getCenterAttendanceHandler">getCenterAttendanceHandler</a></li><li><a href="global.html#getCenterById">getCenterById</a></li><li><a href="global.html#getCenterHandler">getCenterHandler</a></li><li><a href="global.html#getCenterStatistics">getCenterStatistics</a></li><li><a href="global.html#getCenterStatisticsHandler">getCenterStatisticsHandler</a></li><li><a href="global.html#getCentersByState">getCentersByState</a></li><li><a href="global.html#getChildUnits">getChildUnits</a></li><li><a href="global.html#getChildUnitsHandler">getChildUnitsHandler</a></li><li><a href="global.html#getComplianceReport">getComplianceReport</a></li><li><a href="global.html#getComplianceReportHandler">getComplianceReportHandler</a></li><li><a href="global.html#getCurrentUser">getCurrentUser</a></li><li><a href="global.html#getDashboardHandler">getDashboardHandler</a></li><li><a href="global.html#getDashboardSummary">getDashboardSummary</a></li><li><a href="global.html#getDataChangeHistory">getDataChangeHistory</a></li><li><a href="global.html#getDataChangeHistoryHandler">getDataChangeHistoryHandler</a></li><li><a href="global.html#getDateRangeQuery">getDateRangeQuery</a></li><li><a href="global.html#getEntityAuditTrail">getEntityAuditTrail</a></li><li><a href="global.html#getEntityAuditTrailHandler">getEntityAuditTrailHandler</a></li><li><a href="global.html#getEventAnalytics">getEventAnalytics</a></li><li><a href="global.html#getEventAnalyticsHandler">getEventAnalyticsHandler</a></li><li><a href="global.html#getEventAttendance">getEventAttendance</a></li><li><a href="global.html#getEventAttendanceHandler">getEventAttendanceHandler</a></li><li><a href="global.html#getEventById">getEventById</a></li><li><a href="global.html#getEventHandler">getEventHandler</a></li><li><a href="global.html#getEventRegistrationsHandler">getEventRegistrationsHandler</a></li><li><a href="global.html#getEventStatistics">getEventStatistics</a></li><li><a href="global.html#getEventStatisticsHandler">getEventStatisticsHandler</a></li><li><a href="global.html#getGlobalRegistrationsStats">getGlobalRegistrationsStats</a></li><li><a href="global.html#getGlobalRegistrationsStatsHandler">getGlobalRegistrationsStatsHandler</a></li><li><a href="global.html#getGroupById">getGroupById</a></li><li><a href="global.html#getGroupHandler">getGroupHandler</a></li><li><a href="global.html#getGroupMembers">getGroupMembers</a></li><li><a href="global.html#getGroupMembersHandler">getGroupMembersHandler</a></li><li><a href="global.html#getGroupStatistics">getGroupStatistics</a></li><li><a href="global.html#getGroupStatsHandler">getGroupStatsHandler</a></li><li><a href="global.html#getHierarchyHandler">getHierarchyHandler</a></li><li><a href="global.html#getHistoryHandler">getHistoryHandler</a></li><li><a href="global.html#getMemberAttendance">getMemberAttendance</a></li><li><a href="global.html#getMemberAttendanceHandler">getMemberAttendanceHandler</a></li><li><a href="global.html#getMemberAttendanceReport">getMemberAttendanceReport</a></li><li><a href="global.html#getMemberAttendanceReportHandler">getMemberAttendanceReportHandler</a></li><li><a href="global.html#getMemberAttendanceSummary">getMemberAttendanceSummary</a></li><li><a href="global.html#getMemberByAuthId">getMemberByAuthId</a></li><li><a href="global.html#getMemberByCodeHandler">getMemberByCodeHandler</a></li><li><a href="global.html#getMemberByFCSCode">getMemberByFCSCode</a></li><li><a href="global.html#getMemberById">getMemberById</a></li><li><a href="global.html#getMemberHandler">getMemberHandler</a></li><li><a href="global.html#getMemberRegistrations">getMemberRegistrations</a></li><li><a href="global.html#getMemberRegistrationsHandler">getMemberRegistrationsHandler</a></li><li><a href="global.html#getNotificationHistory">getNotificationHistory</a></li><li><a href="global.html#getNotificationTrigger">getNotificationTrigger</a></li><li><a href="global.html#getPaginationParams">getPaginationParams</a></li><li><a href="global.html#getPermissionGroups">getPermissionGroups</a></li><li><a href="global.html#getPermissionGroupsHandler">getPermissionGroupsHandler</a></li><li><a href="global.html#getRegistrarStatisticsHandler">getRegistrarStatisticsHandler</a></li><li><a href="global.html#getRegistrationById">getRegistrationById</a></li><li><a href="global.html#getRegistrationHandler">getRegistrationHandler</a></li><li><a href="global.html#getRegistrationsByEvent">getRegistrationsByEvent</a></li><li><a href="global.html#getRoleById">getRoleById</a></li><li><a href="global.html#getRoleHandler">getRoleHandler</a></li><li><a href="global.html#getRoleUsers">getRoleUsers</a></li><li><a href="global.html#getRoleUsersHandler">getRoleUsersHandler</a></li><li><a href="global.html#getStateAnalytics">getStateAnalytics</a></li><li><a href="global.html#getStateAnalyticsHandler">getStateAnalyticsHandler</a></li><li><a href="global.html#getTriggerHandler">getTriggerHandler</a></li><li><a href="global.html#getUnitById">getUnitById</a></li><li><a href="global.html#getUnitHandler">getUnitHandler</a></li><li><a href="global.html#getUnitHierarchy">getUnitHierarchy</a></li><li><a href="global.html#getUnitMembers">getUnitMembers</a></li><li><a href="global.html#getUnitMembersHandler">getUnitMembersHandler</a></li><li><a href="global.html#getUnitStatistics">getUnitStatistics</a></li><li><a href="global.html#getUnitStatsHandler">getUnitStatsHandler</a></li><li><a href="global.html#getUserAuditTrail">getUserAuditTrail</a></li><li><a href="global.html#getUserAuditTrailHandler">getUserAuditTrailHandler</a></li><li><a href="global.html#getUserById">getUserById</a></li><li><a href="global.html#getUserPermissions">getUserPermissions</a></li><li><a href="global.html#getUserPermissionsHandler">getUserPermissionsHandler</a></li><li><a href="global.html#getUserRoles">getUserRoles</a></li><li><a href="global.html#getUserRolesHandler">getUserRolesHandler</a></li><li><a href="global.html#handleProfileImageUpload">handleProfileImageUpload</a></li><li><a href="global.html#hashPassword">hashPassword</a></li><li><a href="global.html#initPredefinedRolesHandler">initPredefinedRolesHandler</a></li><li><a href="global.html#initializeDatabase">initializeDatabase</a></li><li><a href="global.html#isCenterAdmin">isCenterAdmin</a></li><li><a href="global.html#isDateInFuture">isDateInFuture</a></li><li><a href="global.html#isDateInPast">isDateInPast</a></li><li><a href="global.html#isEventHappening">isEventHappening</a></li><li><a href="global.html#isRegistrationOpen">isRegistrationOpen</a></li><li><a href="global.html#listActiveCenters">listActiveCenters</a></li><li><a href="global.html#listActiveCentersHandler">listActiveCentersHandler</a></li><li><a href="global.html#listCentersByEvent">listCentersByEvent</a></li><li><a href="global.html#listCentersHandler">listCentersHandler</a></li><li><a href="global.html#listEvents">listEvents</a></li><li><a href="global.html#listEventsHandler">listEventsHandler</a></li><li><a href="global.html#listGroupsByEvent">listGroupsByEvent</a></li><li><a href="global.html#listGroupsHandler">listGroupsHandler</a></li><li><a href="global.html#listMembers">listMembers</a></li><li><a href="global.html#listMembersHandler">listMembersHandler</a></li><li><a href="global.html#listNotificationTriggers">listNotificationTriggers</a></li><li><a href="global.html#listRegistrations">listRegistrations</a></li><li><a href="global.html#listRegistrationsHandler">listRegistrationsHandler</a></li><li><a href="global.html#listRoles">listRoles</a></li><li><a href="global.html#listRolesHandler">listRolesHandler</a></li><li><a href="global.html#listTriggersHandler">listTriggersHandler</a></li><li><a href="global.html#listUnits">listUnits</a></li><li><a href="global.html#listUnitsHandler">listUnitsHandler</a></li><li><a href="global.html#logEntityChange">logEntityChange</a></li><li><a href="global.html#logger">logger</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#loginUser">loginUser</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#logoutUser">logoutUser</a></li><li><a href="global.html#markAttendance">markAttendance</a></li><li><a href="global.html#markAttendanceHandler">markAttendanceHandler</a></li><li><a href="global.html#markDeliveredHandler">markDeliveredHandler</a></li><li><a href="global.html#markNotificationAsDelivered">markNotificationAsDelivered</a></li><li><a href="global.html#normalizePhoneNumber">normalizePhoneNumber</a></li><li><a href="global.html#publishEvent">publishEvent</a></li><li><a href="global.html#publishEventHandler">publishEventHandler</a></li><li><a href="global.html#queueNotificationJob">queueNotificationJob</a></li><li><a href="global.html#rateLimitErrorHandler">rateLimitErrorHandler</a></li><li><a href="global.html#refreshToken">refreshToken</a></li><li><a href="global.html#refreshTokenHandler">refreshTokenHandler</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#registerUser">registerUser</a></li><li><a href="global.html#removeCenterAdmin">removeCenterAdmin</a></li><li><a href="global.html#removeCenterAdminHandler">removeCenterAdminHandler</a></li><li><a href="global.html#removeGuardian">removeGuardian</a></li><li><a href="global.html#removeGuardianHandler">removeGuardianHandler</a></li><li><a href="global.html#removeMemberFromGroup">removeMemberFromGroup</a></li><li><a href="global.html#removeMemberFromUnit">removeMemberFromUnit</a></li><li><a href="global.html#removeMemberHandler">removeMemberHandler</a></li><li><a href="global.html#removeRoleFromUser">removeRoleFromUser</a></li><li><a href="global.html#removeRoleHandler">removeRoleHandler</a></li><li><a href="global.html#requestPasswordReset">requestPasswordReset</a></li><li><a href="global.html#requestTimeout">requestTimeout</a></li><li><a href="global.html#resetPassword">resetPassword</a></li><li><a href="global.html#resetPasswordHandler">resetPasswordHandler</a></li><li><a href="global.html#searchMembers">searchMembers</a></li><li><a href="global.html#searchMembersHandler">searchMembersHandler</a></li><li><a href="global.html#sendBatchHandler">sendBatchHandler</a></li><li><a href="global.html#sendBatchNotifications">sendBatchNotifications</a></li><li><a href="global.html#sendMail">sendMail</a></li><li><a href="global.html#sendNotification">sendNotification</a></li><li><a href="global.html#sendNotificationHandler">sendNotificationHandler</a></li><li><a href="global.html#sendOTP">sendOTP</a></li><li><a href="global.html#socketTimeout">socketTimeout</a></li><li><a href="global.html#testDatabaseConnection">testDatabaseConnection</a></li><li><a href="global.html#triggerCenterAssignmentHandler">triggerCenterAssignmentHandler</a></li><li><a href="global.html#triggerCenterAssignmentNotifications">triggerCenterAssignmentNotifications</a></li><li><a href="global.html#triggerEventReminderHandler">triggerEventReminderHandler</a></li><li><a href="global.html#triggerEventReminderNotifications">triggerEventReminderNotifications</a></li><li><a href="global.html#triggerGroupAssignmentHandler">triggerGroupAssignmentHandler</a></li><li><a href="global.html#triggerGroupAssignmentNotifications">triggerGroupAssignmentNotifications</a></li><li><a href="global.html#triggerRegistrationHandler">triggerRegistrationHandler</a></li><li><a href="global.html#triggerRegistrationNotifications">triggerRegistrationNotifications</a></li><li><a href="global.html#updateCenter">updateCenter</a></li><li><a href="global.html#updateCenterHandler">updateCenterHandler</a></li><li><a href="global.html#updateEvent">updateEvent</a></li><li><a href="global.html#updateEventHandler">updateEventHandler</a></li><li><a href="global.html#updateEventSettings">updateEventSettings</a></li><li><a href="global.html#updateEventSettingsHandler">updateEventSettingsHandler</a></li><li><a href="global.html#updateGroup">updateGroup</a></li><li><a href="global.html#updateGroupHandler">updateGroupHandler</a></li><li><a href="global.html#updateMember">updateMember</a></li><li><a href="global.html#updateMemberHandler">updateMemberHandler</a></li><li><a href="global.html#updateNotificationTrigger">updateNotificationTrigger</a></li><li><a href="global.html#updateProfileHandler">updateProfileHandler</a></li><li><a href="global.html#updateRegistrationStatus">updateRegistrationStatus</a></li><li><a href="global.html#updateRegistrationStatusHandler">updateRegistrationStatusHandler</a></li><li><a href="global.html#updateRole">updateRole</a></li><li><a href="global.html#updateRoleHandler">updateRoleHandler</a></li><li><a href="global.html#updateTriggerHandler">updateTriggerHandler</a></li><li><a href="global.html#updateUnit">updateUnit</a></li><li><a href="global.html#updateUnitHandler">updateUnitHandler</a></li><li><a href="global.html#validateAttendanceCode">validateAttendanceCode</a></li><li><a href="global.html#validateCodeHandler">validateCodeHandler</a></li><li><a href="global.html#verifyAttendance">verifyAttendance</a></li><li><a href="global.html#verifyAttendanceHandler">verifyAttendanceHandler</a></li><li><a href="global.html#verifyOTP">verifyOTP</a></li><li><a href="global.html#verifyOTPHandler">verifyOTPHandler</a></li><li><a href="global.html#verifySmtp">verifySmtp</a></li><li><a href="global.html#verifyToken">verifyToken</a></li><li><a href="global.html#withTimeout">withTimeout</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Jan 19 2026 15:24:36 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
