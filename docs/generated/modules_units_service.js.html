<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/units/service.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/units/service.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { getPrismaClient } from '../../lib/prisma.js';
import { NotFoundError, AppError, ForbiddenError } from '../../middleware/error-handler.js';
import { checkScopeAccess } from '../users/service.js';

const prisma = getPrismaClient();

const generateUnitCode = (name, typeName) => {
  const prefix = 'FCS';
  const typeCode = typeName.substring(0, 3).toUpperCase();
  const nameCode = name.replace(/[^a-zA-Z0-9]/g, '').substring(0, 3).toUpperCase();
  const random = Math.floor(1000 + Math.random() * 9000);
  return `${prefix}-${typeCode}-${nameCode}-${random}`;
};

const UNIT_LEVELS = {
  'National': 1,
  'Area': 2,
  'State': 3,
  'Zone': 4,
  'Branch': 5
};

/**
 * Get all descendant unit IDs (looking down)
 */
export const getAllDescendantIds = async (unitId) => {
  const allIds = [];
  let currentLevelIds = [unitId];

  while (currentLevelIds.length > 0) {
    const children = await prisma.unit.findMany({
      where: { parentId: { in: currentLevelIds } },
      select: { id: true }
    });

    const childIds = children.map(c => c.id);
    allIds.push(...childIds);
    currentLevelIds = childIds;
  }

  return allIds;
};

/**
 * Get all ancestor unit IDs (looking up)
 */
export const getAllAncestorIds = async (unitId) => {
  const ancestors = [];
  let currentId = unitId;

  while (currentId) {
    const unit = await prisma.unit.findUnique({
      where: { id: currentId },
      select: { parentId: true }
    });

    if (unit &amp;&amp; unit.parentId) {
      ancestors.push(unit.parentId);
      currentId = unit.parentId;
    } else {
      currentId = null;
    }
  }

  return ancestors;
};

/**
 * Create organizational unit
 */
export const createUnit = async (data, userId) => {
  const { name, type, parentUnitId, description, leaderId } = data;

  // Permission Check
  if (parentUnitId &amp;&amp; userId) {
    const hasAccess = await checkScopeAccess(userId, parentUnitId);
    if (!hasAccess) {
      throw new ForbiddenError('You do not have permission to create units under this parent');
    }
  } else if (userId) {
    // Creating a root unit - strict check?
    // For now, rely on Role Middleware (Super Admin)
    // But if checkScopeAccess(userId, null) returns true, we are fine as long as route has role check.
  }

  // 1. Get or Create Unit Type
  let unitTypeRecord = await prisma.unitType.findFirst({
    where: {
      name: { equals: type, mode: 'insensitive' }
    },
  });


  if (!unitTypeRecord) {
    // Self-healing: Create the type if missing
    // Use Title Case for the name if possible, or just use provided type
    const normalizedType = Object.keys(UNIT_LEVELS).find(k => k.toLowerCase() === type.toLowerCase()) || type;
    const level = UNIT_LEVELS[normalizedType] || 99;


    try {
      unitTypeRecord = await prisma.unitType.create({
        data: {
          name: normalizedType,
          level: level,
          description: `${normalizedType} Level Unit`
        }
      });
    } catch (error) {
      // If creation failed (e.g. race condition or level conflict), try finding by Name OR Level
      // This handles cases where "National" (Level 1) exists as "National HQ"
      unitTypeRecord = await prisma.unitType.findFirst({
        where: {
          OR: [
            { name: { equals: type, mode: 'insensitive' } },
            { level: level }
          ]
        },
      });
    }
  }

  if (!unitTypeRecord) {
    throw new AppError(`Invalid unit type: ${type}`, 400);
  }

  // 2. Verify parent unit if provided
  if (parentUnitId) {
    const parentUnit = await prisma.unit.findUnique({
      where: { id: parentUnitId },
      include: { unitType: true }
    });

    if (!parentUnit) {
      throw new NotFoundError('Parent unit not found');
    }

    // Hierarchy Validation
    const parentType = parentUnit.unitType.name;
    const allowedParents = {
      'Area': ['National'],
      'State': ['Area'],
      'Zone': ['State'],
      'Branch': ['Zone']
    };

    if (allowedParents[type] &amp;&amp; !allowedParents[type].includes(parentType)) {
      throw new AppError(`Invalid hierarchy: ${type} cannot be under ${parentType}`, 400);
    }
  } else if (type !== 'National') {
    // Non-national units must have a parent (except maybe Area/State in some legacy cases, 
    // but for new ones we should enforce it)
    throw new AppError(`${type} level units must have a parent unit`, 400);
  }

  // 3. Generate Code
  const code = generateUnitCode(name, type);

  // 4. Create Unit
  const unit = await prisma.unit.create({
    data: {
      name,
      unitTypeId: unitTypeRecord.id, // Use the resolved ID
      parentId: parentUnitId,
      description,
      code,
    },
    include: {
      unitType: true,
      parent: true
    }
  });

  return {
    ...unit,
    type: unit.unitType.name,
    parentUnitId: unit.parentId,
  };
};

/**
 * Get unit by ID
 */
export const getUnitById = async (unitId) => {
  const unit = await prisma.unit.findUnique({
    where: { id: unitId },
    include: {
      parent: true,
      children: true,
      unitType: true,
      _count: {
        select: { children: true, events: true },
      }
    },
  });

  if (!unit) {
    throw new NotFoundError('Unit not found');
  }

  return {
    ...unit,
    type: unit.unitType.name,
    parentUnitId: unit.parentId,
    childUnits: unit.children,
    childUnitCount: unit._count.children,
  };
};

/**
 * List units with filtering
 */
export const listUnits = async (query = {}) => {
  const {
    page = 1,
    limit = 50,
    type,
    parentUnitId,
    recursive = false,
    search,
    ids,
  } = query;
  const skip = (page - 1) * limit;

  let unitIds = ids;
  if (parentUnitId &amp;&amp; (recursive === true || recursive === 'true')) {
    const descendants = await getAllDescendantIds(parentUnitId);
    unitIds = ids ? ids.filter(id => [parentUnitId, ...descendants].includes(id)) : [parentUnitId, ...descendants];
  }

  const where = {
    isActive: true, // Only show active units by default
    ...(type &amp;&amp; { unitType: { name: type } }),
    ...(parentUnitId &amp;&amp; !(recursive === true || recursive === 'true') &amp;&amp; { parentId: parentUnitId }),
    ...(unitIds &amp;&amp; { id: { in: unitIds } }),
    ...(search &amp;&amp; {
      OR: [
        { name: { contains: search, mode: 'insensitive' } },
        { description: { contains: search, mode: 'insensitive' } },
        { code: { contains: search, mode: 'insensitive' } },
      ],
    }),
  };

  const [units, total] = await Promise.all([
    prisma.unit.findMany({
      where,
      include: {
        unitType: true,
        _count: {
          select: { children: true, events: true },
        },
      },
      orderBy: { name: 'asc' },
      skip: parseInt(skip),
      take: parseInt(limit),
    }),
    prisma.unit.count({ where }),
  ]);

  return {
    data: units.map((u) => ({
      ...u,
      type: u.unitType.name,
      parentUnitId: u.parentId,
      childUnitCount: u._count.children,
      eventCount: u._count.events,
    })),
    pagination: {
      page: parseInt(page),
      limit: parseInt(limit),
      total,
      pages: Math.ceil(total / limit),
    },
  };
};

/**
 * Update unit
 */
export const updateUnit = async (unitId, data, userId) => {
  const unit = await prisma.unit.findUnique({
    where: { id: unitId },
  });

  if (!unit) {
    throw new NotFoundError('Unit not found');
  }

  // Permission Check
  if (userId) {
    const hasAccess = await checkScopeAccess(userId, unitId);
    if (!hasAccess) {
      throw new ForbiddenError('You do not have permission to update this unit');
    }
  }

  const { name, type, description, parentUnitId, leaderId } = data;

  let unitTypeId = undefined;
  if (type) {
    const typeRecord = await prisma.unitType.findFirst({
      where: { name: { equals: type, mode: 'insensitive' } }
    });
    if (typeRecord) unitTypeId = typeRecord.id;
  }

  // If parentUnitId is changed, validate hierarchy
  if (parentUnitId &amp;&amp; parentUnitId !== unit.parentId) {
    // Basic cyclic check: cannot be its own parent
    if (parentUnitId === unitId) {
      throw new AppError('A unit cannot be its own parent', 400);
    }
  }

  const updated = await prisma.unit.update({
    where: { id: unitId },
    data: {
      ...(name &amp;&amp; { name }),
      ...(unitTypeId &amp;&amp; { unitTypeId }),
      ...(description !== undefined &amp;&amp; { description }),
      ...(parentUnitId !== undefined &amp;&amp; { parentId: parentUnitId || null }),
      ...(leaderId !== undefined &amp;&amp; { leaderId: leaderId || null }),
    },
    include: {
      unitType: true
    }
  });

  return {
    ...updated,
    type: updated.unitType.name,
    parentUnitId: updated.parentId,
  };
};

/**
 * Get unit hierarchy
 */
export const getUnitHierarchy = async (rootUnitId = null) => {
  const getHierarchyRecursive = async (unitId) => {
    const unit = await prisma.unit.findUnique({
      where: { id: unitId },
      include: {
        unitType: true,
        _count: { select: { children: true } }
      },
    });

    if (!unit) return null;

    const childUnits = await prisma.unit.findMany({
      where: { parentId: unitId },
    });

    const children = await Promise.all(
      childUnits.map((child) => getHierarchyRecursive(child.id))
    );

    return {
      ...unit,
      type: unit.unitType.name,
      children: children.filter((c) => c !== null),
    };
  };

  if (rootUnitId) {
    return getHierarchyRecursive(rootUnitId);
  }

  const rootUnits = await prisma.unit.findMany({
    where: { parentId: null },
  });

  return Promise.all(rootUnits.map((unit) => getHierarchyRecursive(unit.id)));
};

/**
 * Get child units
 */
export const getChildUnits = async (parentUnitId, recursive = false) => {
  const children = await prisma.unit.findMany({
    where: { parentId: parentUnitId },
    include: {
      unitType: true,
      _count: { select: { children: true } }
    },
    orderBy: { name: 'asc' },
  });

  return children.map((c) => ({
    ...c,
    type: c.unitType.name,
    childUnitCount: c._count.children,
  }));
};

/**
 * Add member to unit
 */
export const addMemberToUnit = async (unitId, memberId) => {
  // Placeholder: Member schema does not have direct unitId relation currently.
  // Implementation deferred.
  throw new AppError('Feature momentarily unavailable due to schema updates', 501);
};

/**
 * Remove member from unit
 */
export const removeMemberFromUnit = async (unitId, memberId) => {
  throw new AppError('Feature momentarily unavailable due to schema updates', 501);
};

/**
 * Get unit members
 */
export const getUnitMembers = async (unitId, query = {}) => {
  return {
    data: [],
    pagination: {
      page: 1,
      limit: 50,
      total: 0,
      pages: 0
    }
  };
};

/**
 * Get unit statistics
 */
export const getUnitStatistics = async (unitId) => {
  return {
    unit: { id: unitId },
    statistics: {
      members: 0,
      events: 0,
      registrations: 0,
      childUnits: 0
    },
    membersByState: []
  };
};

/**
 * Deactivate unit
 */
/**
 * Deactivate unit
 */
export const deactivateUnit = async (unitId, userId) => {
  if (userId) {
    const hasAccess = await checkScopeAccess(userId, unitId);
    if (!hasAccess) {
      throw new ForbiddenError('You do not have permission to deactivate this unit');
    }
  }

  const updated = await prisma.unit.update({
    where: { id: unitId },
    data: { isActive: false },
  });
  return updated;
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addCenterAdmin">addCenterAdmin</a></li><li><a href="global.html#addCenterAdminHandler">addCenterAdminHandler</a></li><li><a href="global.html#addGuardian">addGuardian</a></li><li><a href="global.html#addGuardianHandler">addGuardianHandler</a></li><li><a href="global.html#addMemberHandler">addMemberHandler</a></li><li><a href="global.html#addMemberToUnit">addMemberToUnit</a></li><li><a href="global.html#assignCenter">assignCenter</a></li><li><a href="global.html#assignCenterHandler">assignCenterHandler</a></li><li><a href="global.html#assignGroup">assignGroup</a></li><li><a href="global.html#assignGroupHandler">assignGroupHandler</a></li><li><a href="global.html#assignMemberHandler">assignMemberHandler</a></li><li><a href="global.html#assignMemberToGroup">assignMemberToGroup</a></li><li><a href="global.html#assignRoleHandler">assignRoleHandler</a></li><li><a href="global.html#assignRoleToUser">assignRoleToUser</a></li><li><a href="global.html#assignToBibleStudy">assignToBibleStudy</a></li><li><a href="global.html#buildScopedResponse">buildScopedResponse</a></li><li><a href="global.html#bulkAssignGroups">bulkAssignGroups</a></li><li><a href="global.html#bulkAssignHandler">bulkAssignHandler</a></li><li><a href="global.html#bulkSyncAttendance">bulkSyncAttendance</a></li><li><a href="global.html#bulkSyncHandler">bulkSyncHandler</a></li><li><a href="global.html#calculateAgeBracket">calculateAgeBracket</a></li><li><a href="global.html#calculateAttendanceRate">calculateAttendanceRate</a></li><li><a href="global.html#canAccessRecord">canAccessRecord</a></li><li><a href="global.html#canCommunicate">canCommunicate</a></li><li><a href="global.html#canManageUser">canManageUser</a></li><li><a href="global.html#cancelRegistration">cancelRegistration</a></li><li><a href="global.html#cancelRegistrationHandler">cancelRegistrationHandler</a></li><li><a href="global.html#changePassword">changePassword</a></li><li><a href="global.html#changePasswordHandler">changePasswordHandler</a></li><li><a href="global.html#checkDatabaseTables">checkDatabaseTables</a></li><li><a href="global.html#checkExistence">checkExistence</a></li><li><a href="global.html#checkIn">checkIn</a></li><li><a href="global.html#checkInHandler">checkInHandler</a></li><li><a href="global.html#checkOut">checkOut</a></li><li><a href="global.html#checkOutHandler">checkOutHandler</a></li><li><a href="global.html#checkPermissionHandler">checkPermissionHandler</a></li><li><a href="global.html#checkRegistrationStatus">checkRegistrationStatus</a></li><li><a href="global.html#checkRegistrationStatusHandler">checkRegistrationStatusHandler</a></li><li><a href="global.html#checkUserExistence">checkUserExistence</a></li><li><a href="global.html#checkUserPermission">checkUserPermission</a></li><li><a href="global.html#cleanupOldLogsHandler">cleanupOldLogsHandler</a></li><li><a href="global.html#clearIdempotencyCache">clearIdempotencyCache</a></li><li><a href="global.html#clearOldAuditLogs">clearOldAuditLogs</a></li><li><a href="global.html#cloudinaryDelete">cloudinaryDelete</a></li><li><a href="global.html#cloudinaryUpload">cloudinaryUpload</a></li><li><a href="global.html#cloudinaryUploadAudio">cloudinaryUploadAudio</a></li><li><a href="global.html#cloudinaryUploadDocument">cloudinaryUploadDocument</a></li><li><a href="global.html#cloudinaryUploadImage">cloudinaryUploadImage</a></li><li><a href="global.html#cloudinaryUploadVideo">cloudinaryUploadVideo</a></li><li><a href="global.html#comparePassword">comparePassword</a></li><li><a href="global.html#convertAuditLogsToCSV">convertAuditLogsToCSV</a></li><li><a href="global.html#convertReportToCSV">convertReportToCSV</a></li><li><a href="global.html#correctAttendance">correctAttendance</a></li><li><a href="global.html#correctAttendanceHandler">correctAttendanceHandler</a></li><li><a href="global.html#createAuditLog">createAuditLog</a></li><li><a href="global.html#createCenter">createCenter</a></li><li><a href="global.html#createCenterHandler">createCenterHandler</a></li><li><a href="global.html#createEvent">createEvent</a></li><li><a href="global.html#createEventHandler">createEventHandler</a></li><li><a href="global.html#createGroup">createGroup</a></li><li><a href="global.html#createGroupHandler">createGroupHandler</a></li><li><a href="global.html#createMember">createMember</a></li><li><a href="global.html#createMemberHandler">createMemberHandler</a></li><li><a href="global.html#createNotificationTrigger">createNotificationTrigger</a></li><li><a href="global.html#createPredefinedRoles">createPredefinedRoles</a></li><li><a href="global.html#createRateLimiters">createRateLimiters</a></li><li><a href="global.html#createRegistration">createRegistration</a></li><li><a href="global.html#createRegistrationHandler">createRegistrationHandler</a></li><li><a href="global.html#createRole">createRole</a></li><li><a href="global.html#createRoleHandler">createRoleHandler</a></li><li><a href="global.html#createTriggerHandler">createTriggerHandler</a></li><li><a href="global.html#createUnit">createUnit</a></li><li><a href="global.html#createUnitHandler">createUnitHandler</a></li><li><a href="global.html#deactivateCenter">deactivateCenter</a></li><li><a href="global.html#deactivateCenterHandler">deactivateCenterHandler</a></li><li><a href="global.html#deactivateGroup">deactivateGroup</a></li><li><a href="global.html#deactivateGroupHandler">deactivateGroupHandler</a></li><li><a href="global.html#deactivateMember">deactivateMember</a></li><li><a href="global.html#deactivateMemberHandler">deactivateMemberHandler</a></li><li><a href="global.html#deactivateRole">deactivateRole</a></li><li><a href="global.html#deactivateRoleHandler">deactivateRoleHandler</a></li><li><a href="global.html#deactivateUnit">deactivateUnit</a></li><li><a href="global.html#deactivateUnitHandler">deactivateUnitHandler</a></li><li><a href="global.html#deleteEvent">deleteEvent</a></li><li><a href="global.html#deleteEventHandler">deleteEventHandler</a></li><li><a href="global.html#downloadTagHandler">downloadTagHandler</a></li><li><a href="global.html#exportAuditLogs">exportAuditLogs</a></li><li><a href="global.html#exportAuditLogsHandler">exportAuditLogsHandler</a></li><li><a href="global.html#exportEventReport">exportEventReport</a></li><li><a href="global.html#exportEventReportHandler">exportEventReportHandler</a></li><li><a href="global.html#exportRegistrationsHandler">exportRegistrationsHandler</a></li><li><a href="global.html#exportRegistrationsToCSV">exportRegistrationsToCSV</a></li><li><a href="global.html#filterByScope">filterByScope</a></li><li><a href="global.html#forgotPasswordHandler">forgotPasswordHandler</a></li><li><a href="global.html#formatPaginatedResponse">formatPaginatedResponse</a></li><li><a href="global.html#generateAttendanceCode">generateAttendanceCode</a></li><li><a href="global.html#generateCodeHandler">generateCodeHandler</a></li><li><a href="global.html#generateFCSCode">generateFCSCode</a></li><li><a href="global.html#generateOTP">generateOTP</a></li><li><a href="global.html#generateSignedUrl">generateSignedUrl</a></li><li><a href="global.html#generateTagPdf">generateTagPdf</a></li><li><a href="global.html#generateToken">generateToken</a></li><li><a href="global.html#generateUUID">generateUUID</a></li><li><a href="global.html#getAdminScope">getAdminScope</a></li><li><a href="global.html#getAllAncestorIds">getAllAncestorIds</a></li><li><a href="global.html#getAllDescendantIds">getAllDescendantIds</a></li><li><a href="global.html#getAttendanceSummaryHandler">getAttendanceSummaryHandler</a></li><li><a href="global.html#getAuditLogsByRange">getAuditLogsByRange</a></li><li><a href="global.html#getAuditLogsHandler">getAuditLogsHandler</a></li><li><a href="global.html#getCenterAnalytics">getCenterAnalytics</a></li><li><a href="global.html#getCenterAnalyticsHandler">getCenterAnalyticsHandler</a></li><li><a href="global.html#getCenterAttendance">getCenterAttendance</a></li><li><a href="global.html#getCenterAttendanceHandler">getCenterAttendanceHandler</a></li><li><a href="global.html#getCenterById">getCenterById</a></li><li><a href="global.html#getCenterHandler">getCenterHandler</a></li><li><a href="global.html#getCenterStatistics">getCenterStatistics</a></li><li><a href="global.html#getCenterStatisticsHandler">getCenterStatisticsHandler</a></li><li><a href="global.html#getCentersByState">getCentersByState</a></li><li><a href="global.html#getChildUnits">getChildUnits</a></li><li><a href="global.html#getChildUnitsHandler">getChildUnitsHandler</a></li><li><a href="global.html#getComplianceReport">getComplianceReport</a></li><li><a href="global.html#getComplianceReportHandler">getComplianceReportHandler</a></li><li><a href="global.html#getCurrentUser">getCurrentUser</a></li><li><a href="global.html#getDashboardHandler">getDashboardHandler</a></li><li><a href="global.html#getDashboardSummary">getDashboardSummary</a></li><li><a href="global.html#getDataChangeHistory">getDataChangeHistory</a></li><li><a href="global.html#getDataChangeHistoryHandler">getDataChangeHistoryHandler</a></li><li><a href="global.html#getDateRangeQuery">getDateRangeQuery</a></li><li><a href="global.html#getEffectiveScope">getEffectiveScope</a></li><li><a href="global.html#getEntityAuditTrail">getEntityAuditTrail</a></li><li><a href="global.html#getEntityAuditTrailHandler">getEntityAuditTrailHandler</a></li><li><a href="global.html#getEventAnalytics">getEventAnalytics</a></li><li><a href="global.html#getEventAnalyticsHandler">getEventAnalyticsHandler</a></li><li><a href="global.html#getEventAttendance">getEventAttendance</a></li><li><a href="global.html#getEventAttendanceHandler">getEventAttendanceHandler</a></li><li><a href="global.html#getEventById">getEventById</a></li><li><a href="global.html#getEventHandler">getEventHandler</a></li><li><a href="global.html#getEventRegistrationsHandler">getEventRegistrationsHandler</a></li><li><a href="global.html#getEventStatistics">getEventStatistics</a></li><li><a href="global.html#getEventStatisticsHandler">getEventStatisticsHandler</a></li><li><a href="global.html#getGlobalRegistrationsStats">getGlobalRegistrationsStats</a></li><li><a href="global.html#getGlobalRegistrationsStatsHandler">getGlobalRegistrationsStatsHandler</a></li><li><a href="global.html#getGroupById">getGroupById</a></li><li><a href="global.html#getGroupHandler">getGroupHandler</a></li><li><a href="global.html#getGroupMembers">getGroupMembers</a></li><li><a href="global.html#getGroupMembersHandler">getGroupMembersHandler</a></li><li><a href="global.html#getGroupStatistics">getGroupStatistics</a></li><li><a href="global.html#getGroupStatsHandler">getGroupStatsHandler</a></li><li><a href="global.html#getHierarchyHandler">getHierarchyHandler</a></li><li><a href="global.html#getHistoryHandler">getHistoryHandler</a></li><li><a href="global.html#getImageBuffer">getImageBuffer</a></li><li><a href="global.html#getMemberAttendance">getMemberAttendance</a></li><li><a href="global.html#getMemberAttendanceHandler">getMemberAttendanceHandler</a></li><li><a href="global.html#getMemberAttendanceReport">getMemberAttendanceReport</a></li><li><a href="global.html#getMemberAttendanceReportHandler">getMemberAttendanceReportHandler</a></li><li><a href="global.html#getMemberAttendanceSummary">getMemberAttendanceSummary</a></li><li><a href="global.html#getMemberByAuthId">getMemberByAuthId</a></li><li><a href="global.html#getMemberByCodeHandler">getMemberByCodeHandler</a></li><li><a href="global.html#getMemberByFCSCode">getMemberByFCSCode</a></li><li><a href="global.html#getMemberById">getMemberById</a></li><li><a href="global.html#getMemberHandler">getMemberHandler</a></li><li><a href="global.html#getMemberRegistrations">getMemberRegistrations</a></li><li><a href="global.html#getMemberRegistrationsHandler">getMemberRegistrationsHandler</a></li><li><a href="global.html#getNotificationHistory">getNotificationHistory</a></li><li><a href="global.html#getNotificationTrigger">getNotificationTrigger</a></li><li><a href="global.html#getPaginationParams">getPaginationParams</a></li><li><a href="global.html#getPermissionGroups">getPermissionGroups</a></li><li><a href="global.html#getPermissionGroupsHandler">getPermissionGroupsHandler</a></li><li><a href="global.html#getRegistrarStatisticsHandler">getRegistrarStatisticsHandler</a></li><li><a href="global.html#getRegistrationById">getRegistrationById</a></li><li><a href="global.html#getRegistrationHandler">getRegistrationHandler</a></li><li><a href="global.html#getRegistrationsByEvent">getRegistrationsByEvent</a></li><li><a href="global.html#getRoleById">getRoleById</a></li><li><a href="global.html#getRoleHandler">getRoleHandler</a></li><li><a href="global.html#getRoleUsers">getRoleUsers</a></li><li><a href="global.html#getRoleUsersHandler">getRoleUsersHandler</a></li><li><a href="global.html#getScopeFilter">getScopeFilter</a></li><li><a href="global.html#getStateAnalytics">getStateAnalytics</a></li><li><a href="global.html#getStateAnalyticsHandler">getStateAnalyticsHandler</a></li><li><a href="global.html#getTriggerHandler">getTriggerHandler</a></li><li><a href="global.html#getUnitById">getUnitById</a></li><li><a href="global.html#getUnitHandler">getUnitHandler</a></li><li><a href="global.html#getUnitHierarchy">getUnitHierarchy</a></li><li><a href="global.html#getUnitMembers">getUnitMembers</a></li><li><a href="global.html#getUnitMembersHandler">getUnitMembersHandler</a></li><li><a href="global.html#getUnitStatistics">getUnitStatistics</a></li><li><a href="global.html#getUnitStatsHandler">getUnitStatsHandler</a></li><li><a href="global.html#getUserAuditTrail">getUserAuditTrail</a></li><li><a href="global.html#getUserAuditTrailHandler">getUserAuditTrailHandler</a></li><li><a href="global.html#getUserById">getUserById</a></li><li><a href="global.html#getUserPermissions">getUserPermissions</a></li><li><a href="global.html#getUserPermissionsHandler">getUserPermissionsHandler</a></li><li><a href="global.html#getUserRoles">getUserRoles</a></li><li><a href="global.html#getUserRolesHandler">getUserRolesHandler</a></li><li><a href="global.html#handleProfileImageUpload">handleProfileImageUpload</a></li><li><a href="global.html#hashPassword">hashPassword</a></li><li><a href="global.html#initPredefinedRolesHandler">initPredefinedRolesHandler</a></li><li><a href="global.html#initializeDatabase">initializeDatabase</a></li><li><a href="global.html#isAccessViolation">isAccessViolation</a></li><li><a href="global.html#isCenterAdmin">isCenterAdmin</a></li><li><a href="global.html#isDateInFuture">isDateInFuture</a></li><li><a href="global.html#isDateInPast">isDateInPast</a></li><li><a href="global.html#isEventHappening">isEventHappening</a></li><li><a href="global.html#isRegistrationOpen">isRegistrationOpen</a></li><li><a href="global.html#isWithinScope">isWithinScope</a></li><li><a href="global.html#listActiveCenters">listActiveCenters</a></li><li><a href="global.html#listActiveCentersHandler">listActiveCentersHandler</a></li><li><a href="global.html#listAllCentersForAdmin">listAllCentersForAdmin</a></li><li><a href="global.html#listAllCentersForAdminHandler">listAllCentersForAdminHandler</a></li><li><a href="global.html#listCentersByEvent">listCentersByEvent</a></li><li><a href="global.html#listCentersHandler">listCentersHandler</a></li><li><a href="global.html#listEvents">listEvents</a></li><li><a href="global.html#listEventsHandler">listEventsHandler</a></li><li><a href="global.html#listGroupsByEvent">listGroupsByEvent</a></li><li><a href="global.html#listGroupsHandler">listGroupsHandler</a></li><li><a href="global.html#listMembers">listMembers</a></li><li><a href="global.html#listMembersHandler">listMembersHandler</a></li><li><a href="global.html#listNotificationTriggers">listNotificationTriggers</a></li><li><a href="global.html#listRegistrations">listRegistrations</a></li><li><a href="global.html#listRegistrationsHandler">listRegistrationsHandler</a></li><li><a href="global.html#listRoles">listRoles</a></li><li><a href="global.html#listRolesHandler">listRolesHandler</a></li><li><a href="global.html#listTriggersHandler">listTriggersHandler</a></li><li><a href="global.html#listUnits">listUnits</a></li><li><a href="global.html#listUnitsHandler">listUnitsHandler</a></li><li><a href="global.html#logEntityChange">logEntityChange</a></li><li><a href="global.html#logger">logger</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#loginUser">loginUser</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#logoutUser">logoutUser</a></li><li><a href="global.html#markAttendance">markAttendance</a></li><li><a href="global.html#markAttendanceHandler">markAttendanceHandler</a></li><li><a href="global.html#markDeliveredHandler">markDeliveredHandler</a></li><li><a href="global.html#markNotificationAsDelivered">markNotificationAsDelivered</a></li><li><a href="global.html#normalizePhoneNumber">normalizePhoneNumber</a></li><li><a href="global.html#publishEvent">publishEvent</a></li><li><a href="global.html#publishEventHandler">publishEventHandler</a></li><li><a href="global.html#queueNotificationJob">queueNotificationJob</a></li><li><a href="global.html#rateLimitErrorHandler">rateLimitErrorHandler</a></li><li><a href="global.html#refreshToken">refreshToken</a></li><li><a href="global.html#refreshTokenHandler">refreshTokenHandler</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#registerUser">registerUser</a></li><li><a href="global.html#removeCenterAdmin">removeCenterAdmin</a></li><li><a href="global.html#removeCenterAdminHandler">removeCenterAdminHandler</a></li><li><a href="global.html#removeGuardian">removeGuardian</a></li><li><a href="global.html#removeGuardianHandler">removeGuardianHandler</a></li><li><a href="global.html#removeMemberFromGroup">removeMemberFromGroup</a></li><li><a href="global.html#removeMemberFromUnit">removeMemberFromUnit</a></li><li><a href="global.html#removeMemberHandler">removeMemberHandler</a></li><li><a href="global.html#removeRoleFromUser">removeRoleFromUser</a></li><li><a href="global.html#removeRoleHandler">removeRoleHandler</a></li><li><a href="global.html#requestPasswordReset">requestPasswordReset</a></li><li><a href="global.html#requestTimeout">requestTimeout</a></li><li><a href="global.html#requireScope">requireScope</a></li><li><a href="global.html#resetPassword">resetPassword</a></li><li><a href="global.html#resetPasswordHandler">resetPasswordHandler</a></li><li><a href="global.html#scopedWhere">scopedWhere</a></li><li><a href="global.html#searchMembers">searchMembers</a></li><li><a href="global.html#searchMembersHandler">searchMembersHandler</a></li><li><a href="global.html#sendBatchHandler">sendBatchHandler</a></li><li><a href="global.html#sendBatchNotifications">sendBatchNotifications</a></li><li><a href="global.html#sendMail">sendMail</a></li><li><a href="global.html#sendNotification">sendNotification</a></li><li><a href="global.html#sendNotificationHandler">sendNotificationHandler</a></li><li><a href="global.html#sendOTP">sendOTP</a></li><li><a href="global.html#socketTimeout">socketTimeout</a></li><li><a href="global.html#testDatabaseConnection">testDatabaseConnection</a></li><li><a href="global.html#triggerCenterAssignmentHandler">triggerCenterAssignmentHandler</a></li><li><a href="global.html#triggerCenterAssignmentNotifications">triggerCenterAssignmentNotifications</a></li><li><a href="global.html#triggerEventReminderHandler">triggerEventReminderHandler</a></li><li><a href="global.html#triggerEventReminderNotifications">triggerEventReminderNotifications</a></li><li><a href="global.html#triggerGroupAssignmentHandler">triggerGroupAssignmentHandler</a></li><li><a href="global.html#triggerGroupAssignmentNotifications">triggerGroupAssignmentNotifications</a></li><li><a href="global.html#triggerRegistrationHandler">triggerRegistrationHandler</a></li><li><a href="global.html#triggerRegistrationNotifications">triggerRegistrationNotifications</a></li><li><a href="global.html#updateCenter">updateCenter</a></li><li><a href="global.html#updateCenterHandler">updateCenterHandler</a></li><li><a href="global.html#updateEvent">updateEvent</a></li><li><a href="global.html#updateEventHandler">updateEventHandler</a></li><li><a href="global.html#updateEventSettings">updateEventSettings</a></li><li><a href="global.html#updateEventSettingsHandler">updateEventSettingsHandler</a></li><li><a href="global.html#updateGroup">updateGroup</a></li><li><a href="global.html#updateGroupHandler">updateGroupHandler</a></li><li><a href="global.html#updateMember">updateMember</a></li><li><a href="global.html#updateMemberHandler">updateMemberHandler</a></li><li><a href="global.html#updateNotificationTrigger">updateNotificationTrigger</a></li><li><a href="global.html#updateProfileHandler">updateProfileHandler</a></li><li><a href="global.html#updateRegistrationStatus">updateRegistrationStatus</a></li><li><a href="global.html#updateRegistrationStatusHandler">updateRegistrationStatusHandler</a></li><li><a href="global.html#updateRole">updateRole</a></li><li><a href="global.html#updateRoleHandler">updateRoleHandler</a></li><li><a href="global.html#updateTriggerHandler">updateTriggerHandler</a></li><li><a href="global.html#updateUnit">updateUnit</a></li><li><a href="global.html#updateUnitHandler">updateUnitHandler</a></li><li><a href="global.html#validateAttendanceCode">validateAttendanceCode</a></li><li><a href="global.html#validateCodeHandler">validateCodeHandler</a></li><li><a href="global.html#verifyAttendance">verifyAttendance</a></li><li><a href="global.html#verifyAttendanceHandler">verifyAttendanceHandler</a></li><li><a href="global.html#verifyOTP">verifyOTP</a></li><li><a href="global.html#verifyOTPHandler">verifyOTPHandler</a></li><li><a href="global.html#verifySmtp">verifySmtp</a></li><li><a href="global.html#verifyToken">verifyToken</a></li><li><a href="global.html#withTimeout">withTimeout</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Fri Feb 27 2026 21:40:05 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
