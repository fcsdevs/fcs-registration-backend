<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/reports/service.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/reports/service.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { getPrismaClient } from '../../lib/prisma.js';
import { AppError, NotFoundError } from '../../middleware/error-handler.js';
import { calculateAttendanceRate } from '../../lib/helpers.js';

const prisma = getPrismaClient();

/**
 * Get comprehensive event analytics
 * Returns: registrations by mode, attendance by mode, capacity utilization by center
 */
export const getEventAnalytics = async (eventId, query = {}) => {
  const event = await prisma.event.findUnique({
    where: { id: eventId },
    include: { unit: true },
  });

  if (!event) {
    throw new NotFoundError('Event not found');
  }

  const { startDate, endDate } = query;
  const dateFilter = {
    createdAt: {},
  };

  if (startDate) dateFilter.createdAt.gte = new Date(startDate);
  if (endDate) dateFilter.createdAt.lte = new Date(endDate);

  // Get participation modes for all registrations of this event
  const participations = await prisma.registrationParticipation.findMany({
    where: {
      registration: {
        eventId,
        ...dateFilter
      }
    },
    select: { participationMode: true }
  });

  const registrationsByModeMap = participations.reduce((acc, p) => {
    acc[p.participationMode] = (acc[p.participationMode] || 0) + 1;
    return acc;
  }, {});

  const registrationsByMode = Object.entries(registrationsByModeMap).map(([mode, count]) => ({
    participationMode: mode,
    _count: { id: count }
  }));

  // Get attendance by participation mode
  const attendanceByMode = await prisma.attendanceRecord.groupBy({
    by: ['participationMode'],
    where: {
      registration: { eventId },
    },
    _count: {
      id: true,
    },
  });

  // Get center statistics
  const centers = await prisma.eventCenter.findMany({
    where: { eventId, isActive: true },
    include: {
      _count: {
        select: { registrations: true, attendances: true },
      },
    },
  });

  const centerStats = centers.map((center) => ({
    centerId: center.id,
    name: center.centerName,
    state: center.state,
    registrations: center._count.registrations,
    attendance: center._count.attendances,
  }));

  // Calculate overall statistics
  const totalRegistrations = registrationsByMode.reduce(
    (sum, r) => sum + r._count.id,
    0
  );
  const totalAttendance = attendanceByMode.reduce(
    (sum, a) => sum + a._count.id,
    0
  );
  const attendanceRate =
    totalRegistrations > 0 ? (totalAttendance / totalRegistrations) * 100 : 0;

  return {
    event: {
      id: event.id,
      name: event.title,
      startDate: event.startDate,
      endDate: event.endDate,
      unit: event.unit,
    },
    overview: {
      totalRegistrations,
      totalAttendance,
      attendanceRate: parseFloat(attendanceRate.toFixed(2)),
      totalCenters: centers.length,
    },
    registrationsByMode: registrationsByMode.map((r) => ({
      mode: r.participationMode,
      count: r._count.id,
    })),
    attendanceByMode: attendanceByMode.map((a) => ({
      mode: a.participationMode,
      count: a._count.id,
    })),
    centerStats,
  };
};

/**
 * Get center analytics (registrations, attendance, capacity)
 */
export const getCenterAnalytics = async (centerId, query = {}) => {
  const center = await prisma.eventCenter.findUnique({
    where: { id: centerId },
    include: { event: true },
  });

  if (!center) {
    throw new NotFoundError('Center not found');
  }

  const { startDate, endDate } = query;
  const dateFilter = {
    createdAt: {},
  };

  if (startDate) dateFilter.createdAt.gte = new Date(startDate);
  if (endDate) dateFilter.createdAt.lte = new Date(endDate);

  // Get registrations by participation mode
  const registrations = await prisma.registration.findMany({
    where: {
      centerId,
      ...dateFilter,
    },
    include: {
      member: true,
      group: true,
    },
  });

  // Get attendance records
  const attendance = await prisma.attendanceRecord.findMany({
    where: {
      centerId,
    },
    include: {
      registration: { include: { member: true } },
    },
    orderBy: { checkInTime: 'desc' },
  });

  // Group registrations by mode
  const registrationsByMode = {};
  const attendanceByMode = {};

  registrations.forEach((r) => {
    const mode = r.participationMode;
    registrationsByMode[mode] = (registrationsByMode[mode] || 0) + 1;
  });

  attendance.forEach((a) => {
    const mode = a.participationMode;
    attendanceByMode[mode] = (attendanceByMode[mode] || 0) + 1;
  });

  const attendanceRate =
    registrations.length > 0
      ? (attendance.length / registrations.length) * 100
      : 0;

  return {
    center: {
      id: center.id,
      name: center.centerName,
      state: center.state,
      address: center.address,
    },
    event: {
      id: center.event.id,
      name: center.event.title,
    },
    statistics: {
      totalRegistrations: registrations.length,
      totalAttendance: attendance.length,
      attendanceRate: parseFloat(attendanceRate.toFixed(2)),
    },
    registrationsByMode: Object.entries(registrationsByMode).map(
      ([mode, count]) => ({ mode, count })
    ),
    attendanceByMode: Object.entries(attendanceByMode).map(([mode, count]) => ({
      mode,
      count,
    })),
    recentAttendance: attendance.slice(0, 20).map((a) => ({
      recordId: a.id,
      member: {
        id: a.registration.member.id,
        name: a.registration.member.name,
        fcsCode: a.registration.member.fcsCode,
      },
      checkInTime: a.checkInTime,
      checkOutTime: a.checkOutTime,
      mode: a.participationMode,
    })),
  };
};

/**
 * Get member attendance report
 */
export const getMemberAttendanceReport = async (memberId, query = {}) => {
  const member = await prisma.member.findUnique({
    where: { id: memberId },
  });

  if (!member) {
    throw new NotFoundError('Member not found');
  }

  const { eventId, startDate, endDate } = query;
  const dateFilter = {};

  if (startDate) dateFilter.createdAt = { gte: new Date(startDate) };
  if (endDate)
    dateFilter.createdAt = {
      ...dateFilter.createdAt,
      lte: new Date(endDate),
    };

  // Get attendance records for member
  const attendance = await prisma.attendanceRecord.findMany({
    where: {
      registration: {
        memberId,
        ...(eventId &amp;&amp; { eventId }),
      },
      ...dateFilter,
    },
    include: {
      registration: {
        include: {
          event: true,
          center: true,
        },
      },
    },
    orderBy: { checkInTime: 'desc' },
  });

  // Group by event
  const byEvent = {};
  attendance.forEach((a) => {
    const eventId = a.registration.event.id;
    if (!byEvent[eventId]) {
      byEvent[eventId] = {
        event: a.registration.event,
        records: [],
      };
    }
    byEvent[eventId].records.push(a);
  });

  // Calculate statistics
  const totalAttendance = attendance.length;
  const attendanceByMode = {};

  attendance.forEach((a) => {
    const mode = a.participationMode;
    attendanceByMode[mode] = (attendanceByMode[mode] || 0) + 1;
  });

  return {
    member: {
      id: member.id,
      name: member.name,
      fcsCode: member.fcsCode,
      email: member.email,
      phone: member.phone,
      state: member.state,
    },
    statistics: {
      totalAttendance,
      attendanceByMode: Object.entries(attendanceByMode).map(
        ([mode, count]) => ({ mode, count })
      ),
    },
    eventAttendance: Object.values(byEvent).map((e) => ({
      event: {
        id: e.event.id,
        name: e.event.title,
        startDate: e.event.startDate,
        endDate: e.event.endDate,
      },
      attendance: e.records.map((r) => ({
        recordId: r.id,
        center: r.registration.center?.name || 'Online',
        checkInTime: r.checkInTime,
        checkOutTime: r.checkOutTime,
        mode: r.participationMode,
        duration: r.durationSeconds,
      })),
    })),
  };
};

/**
 * Get state-wise analytics (across all events/centers)
 */
export const getStateAnalytics = async (query = {}) => {
  const { eventId, startDate, endDate } = query;
  const dateFilter = {};

  if (startDate) dateFilter.createdAt = { gte: new Date(startDate) };
  if (endDate)
    dateFilter.createdAt = {
      ...dateFilter.createdAt,
      lte: new Date(endDate),
    };

  // Get member distribution by state
  const membersByState = await prisma.member.groupBy({
    by: ['state'],
    _count: {
      id: true,
    },
  });

  // Get centers by state
  const centersByState = await prisma.eventCenter.groupBy({
    by: ['state'],
    where: {
      ...(eventId &amp;&amp; { eventId }),
      isActive: true,
    },
    _count: {
      id: true,
    },
  });

  // Get registrations by state
  const registrationsByState = await prisma.registration.groupBy({
    by: ['member'],
    where: {
      ...(eventId &amp;&amp; { eventId }),
      ...dateFilter,
    },
  });

  // Group registration state data
  const regByState = {};
  for (const reg of registrationsByState) {
    // Note: This is a simplified grouping; in real implementation,
    // you'd need to join with member state
    regByState[reg.memberId] = (regByState[reg.memberId] || 0) + 1;
  }

  return {
    memberDistribution: membersByState.map((m) => ({
      state: m.state,
      count: m._count.id,
    })),
    centerDistribution: centersByState.map((c) => ({
      state: c.state,
      count: c._count.id,
    })),
    period: {
      startDate,
      endDate,
    },
  };
};

/**
 * Export event report as structured data
 */
export const exportEventReport = async (eventId, format = 'json') => {
  const analytics = await getEventAnalytics(eventId);

  // Add detailed registration list
  const registrations = await prisma.registration.findMany({
    where: { eventId },
    include: {
      member: true,
      center: true,
      group: true,
    },
  });

  const report = {
    exportDate: new Date().toISOString(),
    event: analytics.event,
    overview: analytics.overview,
    statistics: {
      registrationsByMode: analytics.registrationsByMode,
      attendanceByMode: analytics.attendanceByMode,
      centerStats: analytics.centerStats,
    },
    registrations: registrations.map((r) => ({
      registrationId: r.id,
      member: {
        id: r.member.id,
        name: r.member.name,
        fcsCode: r.member.fcsCode,
      },
      participationMode: r.participationMode,
      center: r.center?.centerName || 'N/A',
      group: r.group?.name || 'Unassigned',
      status: r.status,
      registeredAt: r.createdAt,
    })),
  };

  if (format === 'csv') {
    return convertReportToCSV(report);
  }

  return report;
};

/**
 * Convert report to CSV format
 */
const convertReportToCSV = (report) => {
  const headers = [
    'Registration ID',
    'Member Name',
    'FCS Code',
    'Participation Mode',
    'Center',
    'Group',
    'Status',
    'Registered At',
  ];

  const rows = report.registrations.map((r) => [
    r.registrationId,
    r.member.name,
    r.member.fcsCode,
    r.participationMode,
    r.center,
    r.group,
    r.status,
    r.registeredAt,
  ]);

  const csv = [
    headers.join(','),
    ...rows.map((row) =>
      row
        .map((cell) => `"${String(cell).replace(/"/g, '""')}"`)
        .join(',')
    ),
  ].join('\n');

  return csv;
};

/**
 * Get dashboard summary (key metrics)
 */
export const getDashboardSummary = async (query = {}) => {
  const { eventId, centerId } = query;

  // Time boundaries for trends
  const now = new Date();
  const thisMonthStart = new Date(now.getFullYear(), now.getMonth(), 1);
  const lastMonthStart = new Date(now.getFullYear(), now.getMonth() - 1, 1);
  const lastMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0);

  // Scoping logic
  const memberWhere = { isActive: true };
  let eventWhere = { isPublished: true };
  let isNational = false;

  if (query.unitId) {
    const scopeUnit = await prisma.unit.findUnique({
      where: { id: query.unitId },
      include: { unitType: true }
    });
    if (scopeUnit &amp;&amp; scopeUnit.unitType) {
      const typeName = scopeUnit.unitType.name.toLowerCase();
      if (typeName.includes('national')) {
        isNational = true;
      } else {
        if (typeName.includes('state')) memberWhere.state = { contains: scopeUnit.name, mode: 'insensitive' };
        else if (typeName.includes('zone')) memberWhere.zone = { contains: scopeUnit.name, mode: 'insensitive' };
        else if (typeName.includes('branch')) memberWhere.branch = { contains: scopeUnit.name, mode: 'insensitive' };
        eventWhere.unitId = query.unitId;
      }
    }
  }

  // 1. Core Metrics &amp; Trends
  const [
    totalMembers,
    lastMonthMembers,
    activeEventsCount,
    lastMonthEventsCount,
    thisMonthRegistrations,
    lastMonthRegistrations
  ] = await Promise.all([
    prisma.member.count({ where: memberWhere }),
    prisma.member.count({ where: { ...memberWhere, createdAt: { lt: thisMonthStart } } }),
    prisma.event.count({ where: eventWhere }),
    prisma.event.count({ where: { ...eventWhere, createdAt: { gte: lastMonthStart, lte: lastMonthEnd } } }),
    prisma.registration.count({
      where: {
        createdAt: { gte: thisMonthStart },
        ...(query.unitId &amp;&amp; !isNational &amp;&amp; { event: { unitId: query.unitId } })
      }
    }),
    prisma.registration.count({
      where: {
        createdAt: { gte: lastMonthStart, lte: lastMonthEnd },
        ...(query.unitId &amp;&amp; !isNational &amp;&amp; { event: { unitId: query.unitId } })
      }
    }),
  ]);

  // Calculations for Trends
  const memberGrowth = lastMonthMembers > 0 ? ((totalMembers - lastMonthMembers) / lastMonthMembers) * 100 : 0;
  const eventGrowth = lastMonthEventsCount > 0 ? ((activeEventsCount - lastMonthEventsCount) / lastMonthEventsCount) * 100 : 0;
  const registrationGrowth = lastMonthRegistrations > 0 ? ((thisMonthRegistrations - lastMonthRegistrations) / lastMonthRegistrations) * 100 : 0;

  // Check-ins today
  const todayStart = new Date(now.setHours(0, 0, 0, 0));
  const checkedInToday = await prisma.attendanceRecord.count({
    where: {
      checkInTime: { gte: todayStart },
      ...(query.unitId &amp;&amp; !isNational &amp;&amp; { event: { unitId: query.unitId } })
    }
  });

  // 2. Recent/Active Event Summary (Intelligent Selection)
  // Logic: Find an event that is currently happening, or the most recently finished one
  const recentEvent = await prisma.event.findFirst({
    where: eventWhere,
    orderBy: [
      { startDate: 'desc' }
    ],
    include: {
      _count: { select: { registrations: true, attendances: true } },
      centers: {
        include: {
          _count: { select: { registrations: true, attendances: true } }
        }
      }
    }
  });

  let checkInMethods = { qr: 0, sac: 0, manual: 0 };
  if (recentEvent) {
    const records = await prisma.attendanceRecord.groupBy({
      by: ['checkInMethod'],
      where: { eventId: recentEvent.id },
      _count: { id: true }
    });
    records.forEach(r => {
      const method = r.checkInMethod?.toUpperCase();
      if (method === 'QR' || method === 'SCAN') checkInMethods.qr += r._count.id;
      else if (method === 'SAC' || method === 'CODE') checkInMethods.sac += r._count.id;
      else checkInMethods.manual += r._count.id;
    });
  }

  return {
    overview: {
      totalMembers,
      memberGrowth: parseFloat(memberGrowth.toFixed(1)),
      activeEvents: activeEventsCount,
      eventGrowth: parseFloat(eventGrowth.toFixed(1)),
      thisMonthRegistrations,
      registrationGrowth: parseFloat(registrationGrowth.toFixed(1)),
      checkedInToday,
    },
    recentSession: recentEvent ? {
      id: recentEvent.id,
      title: recentEvent.title,
      totalRegistered: recentEvent._count.registrations,
      totalAttended: recentEvent._count.attendances,
      attendanceRate: recentEvent._count.registrations > 0
        ? Math.round((recentEvent._count.attendances / recentEvent._count.registrations) * 100)
        : 0,
      centers: recentEvent.centers.map(c => ({
        name: c.centerName,
        attended: c._count.attendances,
        registered: c._count.registrations
      })),
      checkInMethods
    } : null,
  };
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addCenterAdmin">addCenterAdmin</a></li><li><a href="global.html#addCenterAdminHandler">addCenterAdminHandler</a></li><li><a href="global.html#addGuardian">addGuardian</a></li><li><a href="global.html#addGuardianHandler">addGuardianHandler</a></li><li><a href="global.html#addMemberHandler">addMemberHandler</a></li><li><a href="global.html#addMemberToUnit">addMemberToUnit</a></li><li><a href="global.html#assignCenter">assignCenter</a></li><li><a href="global.html#assignCenterHandler">assignCenterHandler</a></li><li><a href="global.html#assignGroup">assignGroup</a></li><li><a href="global.html#assignGroupHandler">assignGroupHandler</a></li><li><a href="global.html#assignMemberHandler">assignMemberHandler</a></li><li><a href="global.html#assignMemberToGroup">assignMemberToGroup</a></li><li><a href="global.html#assignRoleHandler">assignRoleHandler</a></li><li><a href="global.html#assignRoleToUser">assignRoleToUser</a></li><li><a href="global.html#bulkAssignGroups">bulkAssignGroups</a></li><li><a href="global.html#bulkAssignHandler">bulkAssignHandler</a></li><li><a href="global.html#bulkSyncAttendance">bulkSyncAttendance</a></li><li><a href="global.html#bulkSyncHandler">bulkSyncHandler</a></li><li><a href="global.html#calculateAttendanceRate">calculateAttendanceRate</a></li><li><a href="global.html#cancelRegistration">cancelRegistration</a></li><li><a href="global.html#cancelRegistrationHandler">cancelRegistrationHandler</a></li><li><a href="global.html#changePassword">changePassword</a></li><li><a href="global.html#changePasswordHandler">changePasswordHandler</a></li><li><a href="global.html#checkDatabaseTables">checkDatabaseTables</a></li><li><a href="global.html#checkExistence">checkExistence</a></li><li><a href="global.html#checkIn">checkIn</a></li><li><a href="global.html#checkInHandler">checkInHandler</a></li><li><a href="global.html#checkOut">checkOut</a></li><li><a href="global.html#checkOutHandler">checkOutHandler</a></li><li><a href="global.html#checkPermissionHandler">checkPermissionHandler</a></li><li><a href="global.html#checkUserExistence">checkUserExistence</a></li><li><a href="global.html#checkUserPermission">checkUserPermission</a></li><li><a href="global.html#cleanupOldLogsHandler">cleanupOldLogsHandler</a></li><li><a href="global.html#clearIdempotencyCache">clearIdempotencyCache</a></li><li><a href="global.html#clearOldAuditLogs">clearOldAuditLogs</a></li><li><a href="global.html#cloudinaryDelete">cloudinaryDelete</a></li><li><a href="global.html#cloudinaryUpload">cloudinaryUpload</a></li><li><a href="global.html#cloudinaryUploadAudio">cloudinaryUploadAudio</a></li><li><a href="global.html#cloudinaryUploadDocument">cloudinaryUploadDocument</a></li><li><a href="global.html#cloudinaryUploadImage">cloudinaryUploadImage</a></li><li><a href="global.html#cloudinaryUploadVideo">cloudinaryUploadVideo</a></li><li><a href="global.html#comparePassword">comparePassword</a></li><li><a href="global.html#convertAuditLogsToCSV">convertAuditLogsToCSV</a></li><li><a href="global.html#convertReportToCSV">convertReportToCSV</a></li><li><a href="global.html#correctAttendance">correctAttendance</a></li><li><a href="global.html#correctAttendanceHandler">correctAttendanceHandler</a></li><li><a href="global.html#createAuditLog">createAuditLog</a></li><li><a href="global.html#createCenter">createCenter</a></li><li><a href="global.html#createCenterHandler">createCenterHandler</a></li><li><a href="global.html#createEvent">createEvent</a></li><li><a href="global.html#createEventHandler">createEventHandler</a></li><li><a href="global.html#createGroup">createGroup</a></li><li><a href="global.html#createGroupHandler">createGroupHandler</a></li><li><a href="global.html#createMember">createMember</a></li><li><a href="global.html#createMemberHandler">createMemberHandler</a></li><li><a href="global.html#createNotificationTrigger">createNotificationTrigger</a></li><li><a href="global.html#createPredefinedRoles">createPredefinedRoles</a></li><li><a href="global.html#createRateLimiters">createRateLimiters</a></li><li><a href="global.html#createRegistration">createRegistration</a></li><li><a href="global.html#createRegistrationHandler">createRegistrationHandler</a></li><li><a href="global.html#createRole">createRole</a></li><li><a href="global.html#createRoleHandler">createRoleHandler</a></li><li><a href="global.html#createTriggerHandler">createTriggerHandler</a></li><li><a href="global.html#createUnit">createUnit</a></li><li><a href="global.html#createUnitHandler">createUnitHandler</a></li><li><a href="global.html#deactivateCenter">deactivateCenter</a></li><li><a href="global.html#deactivateCenterHandler">deactivateCenterHandler</a></li><li><a href="global.html#deactivateGroup">deactivateGroup</a></li><li><a href="global.html#deactivateGroupHandler">deactivateGroupHandler</a></li><li><a href="global.html#deactivateMember">deactivateMember</a></li><li><a href="global.html#deactivateMemberHandler">deactivateMemberHandler</a></li><li><a href="global.html#deactivateRole">deactivateRole</a></li><li><a href="global.html#deactivateRoleHandler">deactivateRoleHandler</a></li><li><a href="global.html#deactivateUnit">deactivateUnit</a></li><li><a href="global.html#deactivateUnitHandler">deactivateUnitHandler</a></li><li><a href="global.html#downloadTagHandler">downloadTagHandler</a></li><li><a href="global.html#exportAuditLogs">exportAuditLogs</a></li><li><a href="global.html#exportAuditLogsHandler">exportAuditLogsHandler</a></li><li><a href="global.html#exportEventReport">exportEventReport</a></li><li><a href="global.html#exportEventReportHandler">exportEventReportHandler</a></li><li><a href="global.html#forgotPasswordHandler">forgotPasswordHandler</a></li><li><a href="global.html#formatPaginatedResponse">formatPaginatedResponse</a></li><li><a href="global.html#generateAttendanceCode">generateAttendanceCode</a></li><li><a href="global.html#generateCodeHandler">generateCodeHandler</a></li><li><a href="global.html#generateFCSCode">generateFCSCode</a></li><li><a href="global.html#generateOTP">generateOTP</a></li><li><a href="global.html#generateSignedUrl">generateSignedUrl</a></li><li><a href="global.html#generateTagPdf">generateTagPdf</a></li><li><a href="global.html#generateToken">generateToken</a></li><li><a href="global.html#generateUUID">generateUUID</a></li><li><a href="global.html#getAttendanceSummaryHandler">getAttendanceSummaryHandler</a></li><li><a href="global.html#getAuditLogsByRange">getAuditLogsByRange</a></li><li><a href="global.html#getAuditLogsHandler">getAuditLogsHandler</a></li><li><a href="global.html#getCenterAnalytics">getCenterAnalytics</a></li><li><a href="global.html#getCenterAnalyticsHandler">getCenterAnalyticsHandler</a></li><li><a href="global.html#getCenterAttendance">getCenterAttendance</a></li><li><a href="global.html#getCenterAttendanceHandler">getCenterAttendanceHandler</a></li><li><a href="global.html#getCenterById">getCenterById</a></li><li><a href="global.html#getCenterHandler">getCenterHandler</a></li><li><a href="global.html#getCenterStatistics">getCenterStatistics</a></li><li><a href="global.html#getCenterStatisticsHandler">getCenterStatisticsHandler</a></li><li><a href="global.html#getCentersByState">getCentersByState</a></li><li><a href="global.html#getChildUnits">getChildUnits</a></li><li><a href="global.html#getChildUnitsHandler">getChildUnitsHandler</a></li><li><a href="global.html#getComplianceReport">getComplianceReport</a></li><li><a href="global.html#getComplianceReportHandler">getComplianceReportHandler</a></li><li><a href="global.html#getCurrentUser">getCurrentUser</a></li><li><a href="global.html#getDashboardHandler">getDashboardHandler</a></li><li><a href="global.html#getDashboardSummary">getDashboardSummary</a></li><li><a href="global.html#getDataChangeHistory">getDataChangeHistory</a></li><li><a href="global.html#getDataChangeHistoryHandler">getDataChangeHistoryHandler</a></li><li><a href="global.html#getDateRangeQuery">getDateRangeQuery</a></li><li><a href="global.html#getEntityAuditTrail">getEntityAuditTrail</a></li><li><a href="global.html#getEntityAuditTrailHandler">getEntityAuditTrailHandler</a></li><li><a href="global.html#getEventAnalytics">getEventAnalytics</a></li><li><a href="global.html#getEventAnalyticsHandler">getEventAnalyticsHandler</a></li><li><a href="global.html#getEventAttendance">getEventAttendance</a></li><li><a href="global.html#getEventAttendanceHandler">getEventAttendanceHandler</a></li><li><a href="global.html#getEventById">getEventById</a></li><li><a href="global.html#getEventHandler">getEventHandler</a></li><li><a href="global.html#getEventRegistrationsHandler">getEventRegistrationsHandler</a></li><li><a href="global.html#getEventStatistics">getEventStatistics</a></li><li><a href="global.html#getEventStatisticsHandler">getEventStatisticsHandler</a></li><li><a href="global.html#getGlobalRegistrationsStats">getGlobalRegistrationsStats</a></li><li><a href="global.html#getGlobalRegistrationsStatsHandler">getGlobalRegistrationsStatsHandler</a></li><li><a href="global.html#getGroupById">getGroupById</a></li><li><a href="global.html#getGroupHandler">getGroupHandler</a></li><li><a href="global.html#getGroupMembers">getGroupMembers</a></li><li><a href="global.html#getGroupMembersHandler">getGroupMembersHandler</a></li><li><a href="global.html#getGroupStatistics">getGroupStatistics</a></li><li><a href="global.html#getGroupStatsHandler">getGroupStatsHandler</a></li><li><a href="global.html#getHierarchyHandler">getHierarchyHandler</a></li><li><a href="global.html#getHistoryHandler">getHistoryHandler</a></li><li><a href="global.html#getMemberAttendance">getMemberAttendance</a></li><li><a href="global.html#getMemberAttendanceHandler">getMemberAttendanceHandler</a></li><li><a href="global.html#getMemberAttendanceReport">getMemberAttendanceReport</a></li><li><a href="global.html#getMemberAttendanceReportHandler">getMemberAttendanceReportHandler</a></li><li><a href="global.html#getMemberAttendanceSummary">getMemberAttendanceSummary</a></li><li><a href="global.html#getMemberByAuthId">getMemberByAuthId</a></li><li><a href="global.html#getMemberByCodeHandler">getMemberByCodeHandler</a></li><li><a href="global.html#getMemberByFCSCode">getMemberByFCSCode</a></li><li><a href="global.html#getMemberById">getMemberById</a></li><li><a href="global.html#getMemberHandler">getMemberHandler</a></li><li><a href="global.html#getMemberRegistrations">getMemberRegistrations</a></li><li><a href="global.html#getMemberRegistrationsHandler">getMemberRegistrationsHandler</a></li><li><a href="global.html#getNotificationHistory">getNotificationHistory</a></li><li><a href="global.html#getNotificationTrigger">getNotificationTrigger</a></li><li><a href="global.html#getPaginationParams">getPaginationParams</a></li><li><a href="global.html#getPermissionGroups">getPermissionGroups</a></li><li><a href="global.html#getPermissionGroupsHandler">getPermissionGroupsHandler</a></li><li><a href="global.html#getRegistrarStatisticsHandler">getRegistrarStatisticsHandler</a></li><li><a href="global.html#getRegistrationById">getRegistrationById</a></li><li><a href="global.html#getRegistrationHandler">getRegistrationHandler</a></li><li><a href="global.html#getRegistrationsByEvent">getRegistrationsByEvent</a></li><li><a href="global.html#getRoleById">getRoleById</a></li><li><a href="global.html#getRoleHandler">getRoleHandler</a></li><li><a href="global.html#getRoleUsers">getRoleUsers</a></li><li><a href="global.html#getRoleUsersHandler">getRoleUsersHandler</a></li><li><a href="global.html#getStateAnalytics">getStateAnalytics</a></li><li><a href="global.html#getStateAnalyticsHandler">getStateAnalyticsHandler</a></li><li><a href="global.html#getTriggerHandler">getTriggerHandler</a></li><li><a href="global.html#getUnitById">getUnitById</a></li><li><a href="global.html#getUnitHandler">getUnitHandler</a></li><li><a href="global.html#getUnitHierarchy">getUnitHierarchy</a></li><li><a href="global.html#getUnitMembers">getUnitMembers</a></li><li><a href="global.html#getUnitMembersHandler">getUnitMembersHandler</a></li><li><a href="global.html#getUnitStatistics">getUnitStatistics</a></li><li><a href="global.html#getUnitStatsHandler">getUnitStatsHandler</a></li><li><a href="global.html#getUserAuditTrail">getUserAuditTrail</a></li><li><a href="global.html#getUserAuditTrailHandler">getUserAuditTrailHandler</a></li><li><a href="global.html#getUserById">getUserById</a></li><li><a href="global.html#getUserPermissions">getUserPermissions</a></li><li><a href="global.html#getUserPermissionsHandler">getUserPermissionsHandler</a></li><li><a href="global.html#getUserRoles">getUserRoles</a></li><li><a href="global.html#getUserRolesHandler">getUserRolesHandler</a></li><li><a href="global.html#handleProfileImageUpload">handleProfileImageUpload</a></li><li><a href="global.html#hashPassword">hashPassword</a></li><li><a href="global.html#initPredefinedRolesHandler">initPredefinedRolesHandler</a></li><li><a href="global.html#initializeDatabase">initializeDatabase</a></li><li><a href="global.html#isCenterAdmin">isCenterAdmin</a></li><li><a href="global.html#isDateInFuture">isDateInFuture</a></li><li><a href="global.html#isDateInPast">isDateInPast</a></li><li><a href="global.html#isEventHappening">isEventHappening</a></li><li><a href="global.html#isRegistrationOpen">isRegistrationOpen</a></li><li><a href="global.html#listActiveCenters">listActiveCenters</a></li><li><a href="global.html#listActiveCentersHandler">listActiveCentersHandler</a></li><li><a href="global.html#listCentersByEvent">listCentersByEvent</a></li><li><a href="global.html#listCentersHandler">listCentersHandler</a></li><li><a href="global.html#listEvents">listEvents</a></li><li><a href="global.html#listEventsHandler">listEventsHandler</a></li><li><a href="global.html#listGroupsByEvent">listGroupsByEvent</a></li><li><a href="global.html#listGroupsHandler">listGroupsHandler</a></li><li><a href="global.html#listMembers">listMembers</a></li><li><a href="global.html#listMembersHandler">listMembersHandler</a></li><li><a href="global.html#listNotificationTriggers">listNotificationTriggers</a></li><li><a href="global.html#listRegistrations">listRegistrations</a></li><li><a href="global.html#listRegistrationsHandler">listRegistrationsHandler</a></li><li><a href="global.html#listRoles">listRoles</a></li><li><a href="global.html#listRolesHandler">listRolesHandler</a></li><li><a href="global.html#listTriggersHandler">listTriggersHandler</a></li><li><a href="global.html#listUnits">listUnits</a></li><li><a href="global.html#listUnitsHandler">listUnitsHandler</a></li><li><a href="global.html#logEntityChange">logEntityChange</a></li><li><a href="global.html#logger">logger</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#loginUser">loginUser</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#logoutUser">logoutUser</a></li><li><a href="global.html#markAttendance">markAttendance</a></li><li><a href="global.html#markAttendanceHandler">markAttendanceHandler</a></li><li><a href="global.html#markDeliveredHandler">markDeliveredHandler</a></li><li><a href="global.html#markNotificationAsDelivered">markNotificationAsDelivered</a></li><li><a href="global.html#normalizePhoneNumber">normalizePhoneNumber</a></li><li><a href="global.html#publishEvent">publishEvent</a></li><li><a href="global.html#publishEventHandler">publishEventHandler</a></li><li><a href="global.html#queueNotificationJob">queueNotificationJob</a></li><li><a href="global.html#rateLimitErrorHandler">rateLimitErrorHandler</a></li><li><a href="global.html#refreshToken">refreshToken</a></li><li><a href="global.html#refreshTokenHandler">refreshTokenHandler</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#registerUser">registerUser</a></li><li><a href="global.html#removeCenterAdmin">removeCenterAdmin</a></li><li><a href="global.html#removeCenterAdminHandler">removeCenterAdminHandler</a></li><li><a href="global.html#removeGuardian">removeGuardian</a></li><li><a href="global.html#removeGuardianHandler">removeGuardianHandler</a></li><li><a href="global.html#removeMemberFromGroup">removeMemberFromGroup</a></li><li><a href="global.html#removeMemberFromUnit">removeMemberFromUnit</a></li><li><a href="global.html#removeMemberHandler">removeMemberHandler</a></li><li><a href="global.html#removeRoleFromUser">removeRoleFromUser</a></li><li><a href="global.html#removeRoleHandler">removeRoleHandler</a></li><li><a href="global.html#requestPasswordReset">requestPasswordReset</a></li><li><a href="global.html#requestTimeout">requestTimeout</a></li><li><a href="global.html#resetPassword">resetPassword</a></li><li><a href="global.html#resetPasswordHandler">resetPasswordHandler</a></li><li><a href="global.html#searchMembers">searchMembers</a></li><li><a href="global.html#searchMembersHandler">searchMembersHandler</a></li><li><a href="global.html#sendBatchHandler">sendBatchHandler</a></li><li><a href="global.html#sendBatchNotifications">sendBatchNotifications</a></li><li><a href="global.html#sendMail">sendMail</a></li><li><a href="global.html#sendNotification">sendNotification</a></li><li><a href="global.html#sendNotificationHandler">sendNotificationHandler</a></li><li><a href="global.html#sendOTP">sendOTP</a></li><li><a href="global.html#socketTimeout">socketTimeout</a></li><li><a href="global.html#testDatabaseConnection">testDatabaseConnection</a></li><li><a href="global.html#triggerCenterAssignmentHandler">triggerCenterAssignmentHandler</a></li><li><a href="global.html#triggerCenterAssignmentNotifications">triggerCenterAssignmentNotifications</a></li><li><a href="global.html#triggerEventReminderHandler">triggerEventReminderHandler</a></li><li><a href="global.html#triggerEventReminderNotifications">triggerEventReminderNotifications</a></li><li><a href="global.html#triggerGroupAssignmentHandler">triggerGroupAssignmentHandler</a></li><li><a href="global.html#triggerGroupAssignmentNotifications">triggerGroupAssignmentNotifications</a></li><li><a href="global.html#triggerRegistrationHandler">triggerRegistrationHandler</a></li><li><a href="global.html#triggerRegistrationNotifications">triggerRegistrationNotifications</a></li><li><a href="global.html#updateCenter">updateCenter</a></li><li><a href="global.html#updateCenterHandler">updateCenterHandler</a></li><li><a href="global.html#updateEvent">updateEvent</a></li><li><a href="global.html#updateEventHandler">updateEventHandler</a></li><li><a href="global.html#updateEventSettings">updateEventSettings</a></li><li><a href="global.html#updateEventSettingsHandler">updateEventSettingsHandler</a></li><li><a href="global.html#updateGroup">updateGroup</a></li><li><a href="global.html#updateGroupHandler">updateGroupHandler</a></li><li><a href="global.html#updateMember">updateMember</a></li><li><a href="global.html#updateMemberHandler">updateMemberHandler</a></li><li><a href="global.html#updateNotificationTrigger">updateNotificationTrigger</a></li><li><a href="global.html#updateProfileHandler">updateProfileHandler</a></li><li><a href="global.html#updateRegistrationStatus">updateRegistrationStatus</a></li><li><a href="global.html#updateRegistrationStatusHandler">updateRegistrationStatusHandler</a></li><li><a href="global.html#updateRole">updateRole</a></li><li><a href="global.html#updateRoleHandler">updateRoleHandler</a></li><li><a href="global.html#updateTriggerHandler">updateTriggerHandler</a></li><li><a href="global.html#updateUnit">updateUnit</a></li><li><a href="global.html#updateUnitHandler">updateUnitHandler</a></li><li><a href="global.html#validateAttendanceCode">validateAttendanceCode</a></li><li><a href="global.html#validateCodeHandler">validateCodeHandler</a></li><li><a href="global.html#verifyAttendance">verifyAttendance</a></li><li><a href="global.html#verifyAttendanceHandler">verifyAttendanceHandler</a></li><li><a href="global.html#verifyOTP">verifyOTP</a></li><li><a href="global.html#verifyOTPHandler">verifyOTPHandler</a></li><li><a href="global.html#verifyToken">verifyToken</a></li><li><a href="global.html#withTimeout">withTimeout</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Jan 14 2026 03:49:44 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
